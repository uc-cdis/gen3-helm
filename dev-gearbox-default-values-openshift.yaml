# Global configuration
global:
  portal_app: gitops
  authz_entity_name: "subject"

  # -- (map) Pod security context settings
  compatibility:
    # -- (map) OpenShift Settings
    openshift:
      # -- (bool) Set to force if deploying to OpenShift
      adaptSecurityContext: force
 
  
arborist:
  enabled: false
  # -- (map) Resource requests and limits for the containers in the pod
  resources:
    # -- (map) The amount of resources that the container requests
    requests:
      # -- (string) The amount of memory requested
      memory: 12Mi
      # -- (string) The amount of CPU requested (e.g., 100m = 0.1 CPU)
      cpu: 100m
    # -- (map) The maximum amount of resources that the container is allowed to use
    limits:
      # -- (string) The maximum amount of memory the container can use
      memory: 512Mi
      # -- (string) The maximum amount of CPU the container can use
      cpu: 500m
  #local Dev Only
  # postgres:
  #   password: "arborist_thisisaweakpassword"
  image:
    # repository: quay.io/pcdc/arborist
    # tag: 2025.09
    repository: "973342646972.dkr.ecr.us-east-1.amazonaws.com/openshift-pcdc/arborist"
    tag: "latest"
    pullPolicy: Always
  service:
    # -- (string) Type of service. Valid values are "ClusterIP", "NodePort", "LoadBalancer", "ExternalName".
    type: ClusterIP
    # -- (int) The port number that the service exposes.
    port: 80
    targetPort: 8080
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000970000
    runAsGroup: 1000970000
    fsGroup: 1000970000

fence:
  #local Dev Only
  # postgres:
  #   password: "fence_thisisaweakpassword"
  FENCE_CONFIG:
    DEBUG: true
    MOCK_STORAGE: true
    #fill in
    AMANUENSIS_PUBLIC_KEY_PATH: "/fence/keys/key/jwt_public_key.pem"
    MOCK_GOOGLE_AUTH: true
    mock_default_user: "test@example.com"
    ENABLE_VISA_UPDATE_CRON: false
    ENABLE_DELETE_EXPIRED_CLIENTS: false
    ENABLE_FENCE_DEPLOYMENT: true
    ENABLE_PRESIGNED_URL_FENCE: false
    USER_YAML_ENABLED: false
  volumes:
    - name: old-config-volume
      secret:
        secretName: "fence-secret"
    - name: json-secret-volume
      secret:
        secretName: "fence-json-secret"
        optional: true
    - name: creds-volume
      secret:
        secretName: "fence-creds"
    - name: config-helper
      configMap:
        name: config-helper
        optional: true
    - name: logo-volume
      configMap:
        name: "logo-config"
    - name: config-volume
      secret:
        secretName: "fence-config"
    - name: fence-google-app-creds-secret-volume
      secret:
        secretName: "fence-google-app-creds-secret"
    - name: fence-google-storage-creds-secret-volume
      secret:
        secretName: "fence-google-storage-creds-secret"
    - name: fence-jwt-keys
      secret:
        secretName: "fence-jwt-keys"
    - name: privacy-policy
      configMap:
        name: "privacy-policy"
    - name: yaml-merge
      configMap:
        name: "fence-yaml-merge"
        optional: true
    - name: config-volume-public
      configMap:
        name: "manifest-fence"
        optional: true
    - name: nginx-config
      configMap:
        name: nginx-config
        items:
          - key: nginx.conf
            path: nginx.conf

  volumeMounts:
    - name: "old-config-volume"
      readOnly: true
      mountPath: "/var/www/fence/local_settings.py"
      subPath: local_settings.py
    - name: "json-secret-volume"
      readOnly: true
      mountPath: "/var/www/fence/fence_credentials.json"
      subPath: fence_credentials.json
    - name: "creds-volume"
      readOnly: true
      mountPath: "/var/www/fence/creds.json"
      subPath: creds.json
    - name: "config-helper"
      readOnly: true
      mountPath: "/var/www/fence/config_helper.py"
      subPath: config_helper.py
    - name: "logo-volume"
      readOnly: true
      mountPath: "/fence/fence/static/img/logo.svg"
      subPath: "logo.svg"
    - name: "privacy-policy"
      readOnly: true
      mountPath: "/fence/fence/static/privacy_policy.md"
      subPath: "privacy_policy.md"
    - name: "config-volume"
      readOnly: true
      mountPath: "/var/www/fence/fence-config.yaml"
      subPath: fence-config.yaml
    - name: "yaml-merge"
      readOnly: true
      mountPath: "/var/www/fence/yaml_merge.py"
      subPath: yaml_merge.py
    - name: "fence-google-app-creds-secret-volume"
      readOnly: true
      mountPath: "/var/www/fence/fence_google_app_creds_secret.json"
      subPath: fence_google_app_creds_secret.json
    - name: "fence-google-storage-creds-secret-volume"
      readOnly: true
      mountPath: "/var/www/fence/fence_google_storage_creds_secret.json"
      subPath: fence_google_storage_creds_secret.json
    - name: "fence-jwt-keys"
      readOnly: true
      mountPath: "/fence/keys/key/jwt_private_key.pem"
      subPath: "jwt_private_key.pem"
    - name: "fence-jwt-keys"
      readOnly: true
      mountPath: "/fence/keys/key/jwt_public_key.pem"
      subPath: "jwt_public_key.pem"
    - name: "config-volume-public"
      readOnly: true
      mountPath: "/var/www/fence/fence-config-public.yaml"
      subPath: fence-config-public.yaml
    - name: nginx-config
      mountPath: /etc/nginx/nginx.conf
      subPath: nginx.conf
      readOnly: true

    # -- (list) Volumes to mount to the init container.

  initVolumeMounts:
    - name: "config-volume"
      readOnly: true
      mountPath: "/var/www/fence/fence-config.yaml"
      subPath: fence-config.yaml
    - name: "config-volume-public"
      readOnly: true
      mountPath: "/var/www/fence/fence-config-public.yaml"
      subPath: fence-config-public.yaml
    - name: "yaml-merge"
      readOnly: true
      mountPath: "/var/www/fence/yaml_merge.py"
      subPath: yaml_merge.py
    - name: "fence-google-app-creds-secret-volume"
      readOnly: true
      mountPath: "/var/www/fence/fence_google_app_creds_secret.json"
      subPath: fence_google_app_creds_secret.json
    - name: "fence-google-storage-creds-secret-volume"
      readOnly: true
      mountPath: "/var/www/fence/fence_google_storage_creds_secret.json"
      subPath: fence_google_storage_creds_secret.json

  service:
    # -- (string) Type of service. Valid values are "ClusterIP", "NodePort", "LoadBalancer", "ExternalName".
    type: ClusterIP
    # -- (int) The port number that the service exposes.
    port: 80
    targetPort: 8080
  podSecurityContext:
    runAsNonRoot: true
    # runAsUser: 1000970000
    # runAsGroup: 1000970000
    # fsGroup: 1000970000
    supplementalGroups:
      - 1000
  # -- (map) Resource requests and limits for the containers in the pod
  resources:
    # -- (map) The amount of resources that the container requests
    requests:
      # -- (string) The amount of memory requested
      memory: 12Mi
      # -- (string) The amount of CPU requested (e.g., 100m = 0.1 CPU)
      cpu: 100m
    # -- (map) The maximum amount of resources that the container is allowed to use
    limits:
      # -- (string) The maximum amount of memory the container can use
      memory: 512Mi
      # -- (string) The maximum amount of CPU the container can use
      cpu: 500m
  image:
    # repository: quay.io/pcdc/fence
    # tag: "3.6.0"
    # pullPolicy: IfNotPresent
    repository: "973342646972.dkr.ecr.us-east-1.amazonaws.com/openshift-pcdc/fence"
    tag: "latest"
    pullPolicy: Always
  USER_YAML: |
    authz:

      resources:
        - name: 'gearbox_gateway'
        - name: 'data_file'
          description: 'data files, stored in S3'
        - name: 'sower'
          description: 'sower resource'
        - name: workspace
          description: jupyter notebooks
        - name: analysis
          description: analysis tool service
        - name: portal
          description: data portal service
        - name: privacy
          description: User privacy policy
        - name: 'services'
          subresources:
          - name: 'sheepdog'
            subresources:
            - name: 'submission'
              subresources:
              - name: 'program'
              - name: 'project'
          - name: 'amanuensis'
          - name: 'fence'
            subresources:
              - name: 'admin'
        - name: programs
          subresources:
          - name: pcdc

      policies:
        - id: gearbox_admin
          resource_paths: ['/gearbox_gateway']
          role_ids: ['gearbox_user']
        - id: 'data_upload'
          description: 'upload raw data files to S3'
          resource_paths: 
          - /data_file
          role_ids: 
          - file_uploader
        - id: 'services.amanuensis-admin'
          description: 'admin access to amanuensis'
          role_ids:
            - 'amanuensis_admin'
          resource_paths:
            - '/services/amanuensis'
        - id: 'services.fence-admin'
          description: 'admin access to fence'
          role_ids:
            - 'fence_admin'
          resource_paths:
            - '/services/fence/admin'   
        - id: workspace
          description: be able to use workspace
          resource_paths: 
          - /workspace
          role_ids: 
          - workspace_user
        - id: analysis
          description: be able to use analysis tool service
          resource_paths: 
          - /analysis
          role_ids: 
          - analysis_user
        - id: privacy_policy
          description:  User agreed on the privacy policy
          resource_paths:
            - /privacy
          role_ids:
            - reader
        - id: indexd_admin
          description: full access to indexd API
          role_ids:
            - indexd_admin
          resource_paths:
            - /programs
        - description: be able to use sower job
          id: sower
          resource_paths: [/sower]
          role_ids: [sower_user]
        - id: 'services.sheepdog-admin'
          description: 'CRUD access to programs and projects'
          role_ids:
            - 'sheepdog_admin'
          resource_paths:
            - '/services/sheepdog/submission/program'
            - '/services/sheepdog/submission/project'
        - id: all_programs_reader
          role_ids:
          - reader
          - storage_reader
          resource_paths:
          - /programs
        - id: login_no_access
          role_ids:
          - reader
          resource_paths:
          - /portal
        - id: 'data_admin'
          description: 'policy test, should write a policy per resource and assign to user in order to avoid duplicating policies'
          role_ids:
            - admin
          resource_paths:
            - /programs
            - /programs/pcdc
          

      roles:
        - id: 'gearbox_user'
          permissions:
            - id: 'gearbox_access'
              action:
                  service: '*'
                  method: '*'
        - id: 'file_uploader'
          description: 'can upload data files'
          permissions:
            - id: 'file_upload'
              action:
                  service: 'fence'
                  method: 'file_upload'
        - id: 'amanuensis_admin'
          description: 'can do admin work on project/data request'
          permissions:
            - id: 'amanuensis_admin_action'
              action: 
                  service: 'amanuensis'
                  method: '*'
        - id: 'fence_admin'
          description: 'can use the admin endpoint in Fence'
          permissions:
            - id: 'fence_admin_permission'
              action: 
                  service: 'fence'
                  method: '*'
        - id: workspace_user
          permissions:
          - action: {method: access, service: jupyterhub}
            id: workspace_access
        - id: sower_user
          permissions:
          - action: {method: access, service: job}
            id: sower_access
        - id: analysis_user
          permissions:
          - action: {method: access, service: analysis}
            id: analysis_access
        # Sheepdog admin role
        - id: 'sheepdog_admin'
          description: 'sheepdog admin role for program project crud'
          permissions:
            - id: 'sheepdog_admin_action'
              action:
                service: 'sheepdog'
                method: '*'
        - id: indexd_admin
          description: full access to indexd API
          permissions:
          - id: indexd_admin
            action:
              service: indexd
              method: '*'
        - id: admin
          permissions:
            - id: admin
              action:
                service: '*'
                method: '*'
        - id: creator
          permissions:
            - id: creator
              action:
                service: '*'
                method: create
        - id: reader
          permissions:
            - id: reader
              action:
                service: '*'
                method: read
        - id: updater
          permissions:
            - id: updater
              action:
                service: '*'
                method: update
        - id: deleter
          permissions:
            - id: deleter
              action:
                service: '*'
                method: delete
        - id: storage_writer
          permissions:
            - id: storage_creator
              action:
                service: '*'
                method: write-storage
        - id: storage_reader
          permissions:
            - id: storage_reader
              action:
                service: '*'
                method: read-storage
      
    users:
      ### BEGIN INTERNS SECTION ###
      ### END INTERNS SECTION ###
      pmurdoch@uchicago.edu:
        admin: true
        policies:
          - gearbox_admin
          - data_upload
          - workspace
          - services.sheepdog-admin
          - services.amanuensis-admin
          - data_admin
          - analysis
          - privacy_policy
          - login_no_access
          - sower

portal:
  enabled: false
  image:
    repository: "973342646972.dkr.ecr.us-east-1.amazonaws.com/openshift-pcdc/gearbox-fe"
    tag: "latest"
    pullPolicy: Always
  # -- (map) Resource requests and limits for the containers in the pod
  resources:
    # -- (map) The amount of resources that the container requests
    requests:
      cpu: 1.0
      memory: 1024Mi
    limits:
      cpu: 2.0
      memory: 4096Mi
    # -- (map) The maximum amount of resources that the container is allowed to use
  service:
    # -- (string) Type of service. Valid values are "ClusterIP", "NodePort", "LoadBalancer", "ExternalName".
    type: ClusterIP
    # -- (int) The port number that the service exposes.
    port: 80
    targetPort: 8080
  gitops:
    json: |
      {
        "s3_bucket": "https://test-compose-gearbox-data-bucket-with-versioning.s3.amazonaws.com"
      }
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000970000
    runAsGroup: 1000970000
    fsGroup: 1000970000
  gearboxS3Bucket: "https://test-compose-gearbox-data-bucket-with-versioning.s3.amazonaws.com"

revproxy:
  enabled: true
  nginx:
    user: "nginx"
    resolver: "dns-default.openshift-dns.svc.cluster.local"
  service:
    # -- (string) Type of service. Valid values are "ClusterIP", "NodePort", "LoadBalancer", "ExternalName".
    type: ClusterIP
    # -- (int) The port number that the service exposes.
    port: 80
    targetPort: 8080
  image:
    repository: quay.io/cdis/nginx
    tag: 2025.09
  # -- (map) Resource requests and limits for the containers in the pod
  resources:
    # -- (map) The amount of resources that the container requests
    requests:
      # -- (string) The amount of CPU requested (e.g., 100m = 0.1 CPU)
      cpu: 100m
      # -- (string) The amount of memory requested
      memory: 12Mi
    # -- (map) The maximum amount of resources that the container is allowed to use
    limits:
      # -- (string) The maximum amount of memory the container can use
      memory: 512Mi
      # -- (string) The maximum amount of CPU the container can use
      cpu: 500m

gearbox:
  enabled: false
  image:
    # repository: quay.io/pcdc/gearbox_be
    # tag: "pcdc_dev_2025-08-26T14_03_39-05_00"
    # pullPolicy: Always
    repository: "973342646972.dkr.ecr.us-east-1.amazonaws.com/openshift-pcdc/gearbox-matching"
    tag: "latest"
    pullPolicy: Always
  service:
    # -- (string) Type of service. Valid values are "ClusterIP", "NodePort", "LoadBalancer", "ExternalName".
    type: ClusterIP
    # -- (int) The port number that the service exposes.
    port: 80
    targetPort: 8080
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000970000
    runAsGroup: 1000970000
    fsGroup: 1000970000
  volumes:
    - name: config-volume
      secret:
        secretName: "gearbox-g3auto"
    - name: gearbox-middleware-jwt-keys
      secret:
        secretName: "gearbox-middleware-jwt-keys"
        items:
          - key: jwt_public_key.pem
            path: jwt_public_key.pem
        optional: false
    - name: nginx-config
      configMap:
        name: nginx-config
        items:
          - key: nginx.conf
            path: nginx.conf
  volumeMounts:
    - name: "gearbox-middleware-jwt-keys"
      readOnly: true
      mountPath: "/gearbox/src/gearbox/keys/jwt_public_key.pem"
      subPath: jwt_public_key.pem
    - name: config-volume
      readOnly: true
      mountPath: /gearbox/.env
      subPath: gearbox.env
    - name: nginx-config
      mountPath: /etc/nginx/nginx.conf
      subPath: nginx.conf
      readOnly: true
  resources:
    # -- (map) The amount of resources that the container requests
    requests:
      # -- (string) The amount of memory requested
      memory: 12Mi
      # -- (string) The amount of CPU requested (e.g., 100m = 0.1 CPU)
      cpu: 100m
    # -- (map) The maximum amount of resources that the container is allowed to use
    limits:
      # -- (string) The maximum amount of memory the container can use
      memory: 512Mi
      # -- (string) The maximum amount of CPU the container can use
      cpu: 500m
gearbox-middleware:
  enabled: false
  gearboxMiddlewareG3auto:
    testing: False
  service:
    # -- (string) Type of service. Valid values are "ClusterIP", "NodePort", "LoadBalancer", "ExternalName".
    type: ClusterIP
    # -- (int) The port number that the service exposes.
    port: 80
    targetPort: 8080
  image:
    # repository: quay.io/pcdc/gearbox-middleware
    # tag: "pcdc_dev_Fri__15_Aug_2025_17_57_50_GMT"
    # pullPolicy: Always
    repository: "973342646972.dkr.ecr.us-east-1.amazonaws.com/openshift-pcdc/gearbox-middleware"
    tag: "latest"
    pullPolicy: Always
  # -- (list) Volumes to attach to the container.
  volumes:
    - name: config-volume
      secret:
        secretName: "gearbox-middleware-g3auto"
    - name: gearbox-middleware-jwt-keys
      secret:
        secretName: "gearbox-middleware-jwt-keys"
        items:
          - key: jwt_private_key.pem
            path: jwt_private_key.pem
        optional: false
    - name: nginx-config
      configMap:
        name: nginx-config
        items:
          - key: nginx.conf
            path: nginx.conf
  volumeMounts:
    - name: "gearbox-middleware-jwt-keys"
      readOnly: true
      mountPath: "/gearbox-middleware/gearbox_middleware/keys/jwt_private_key.pem"
      subPath: jwt_private_key.pem
    - name: config-volume
      readOnly: true
      mountPath: /gearbox-middleware/.env
      subPath: gearbox-middleware.env
    - name: nginx-config
      mountPath: /etc/nginx/nginx.conf
      subPath: nginx.conf
      readOnly: true
  resources:
    # -- (map) The amount of resources that the container requests
    requests:
      # -- (string) The amount of memory requested
      memory: 12Mi
      # -- (string) The amount of CPU requested (e.g., 100m = 0.1 CPU)
      cpu: 100m
    # -- (map) The maximum amount of resources that the container is allowed to use
    limits:
      # -- (string) The maximum amount of memory the container can use
      memory: 512Mi
      # -- (string) The maximum amount of CPU the container can use
      cpu: 500m
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000970000
    runAsGroup: 1000970000
    fsGroup: 1000970000

postgresql:
  image:
    repository: bitnamilegacy/postgresql
  primary:
    networkPolicy:
      enabled: false
  readReplicas:
    networkPolicy:
      enabled: false
  #local Dev Only
  # auth:
  #   postgresPassword: "thisisaterriblepassword"
  # primary:
  #   persistence:
  #     enabled: true
  #     size: 1Gi
########################################################################################
#                               DISABLED SERVICES                                      #
########################################################################################
elasticsearch:
  enabled: false

amanuensis:
  enabled: false

guppy:
  enabled: false

manifestservice:
  enabled: false

pcdcanalysistools:
  enabled: false

peregrine:
  enabled: false

sheepdog:
  enabled: false

sower:
  enabled: false

wts:
  enabled: false

ambassador:
  # -- (bool) Whether to deploy the ambassador subchart.
  enabled: false

argo-wrapper:
  # -- (bool) Whether to deploy the argo-wrapper subchart.
  enabled: false

audit:
  # -- (bool) Whether to deploy the audit subchart.
  enabled: false

aws-es-proxy:
  enabled: false

metadata:
  # -- (bool) Whether to deploy the metadata subchart.
  enabled: false

pidgin:
  # -- (bool) Whether to deploy the pidgin subchart.
  enabled: false

indexd:
  enabled: false

hatchery:
  enabled: false

cohort-middleware:
  enabled: false

etl:
  enabled: false

gen3-network-policies:
  enabled: false
