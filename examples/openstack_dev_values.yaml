# Default values for gen3.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global configuration
global:
  # -- (map) AWS configuration
  aws:
    # -- (bool) Set to true if deploying to AWS. Controls ingress annotations.
    enabled: false
    # -- (string) Credentials for AWS stuff.
    awsAccessKeyId:
    # -- (string) Credentials for AWS stuff.
    awsSecretAccessKey:
    # -- (map) Local secret setting if using a pre-exising secret.
    useLocalSecret:
      # -- (bool) Set to true if you would like to use a secret that is already running on your cluster.
      enabled: false
      # -- (string) Name of the local secret.
      localSecretName:
  # -- (bool) Deploys postgres/elasticsearch for dev
  dev: false
  postgres:
    # -- (bool) Whether the database create job should run.
    dbCreate: false
    master:
      # -- global postgres master username
      username: "postgres"
      # -- global postgres master password
      password: "xxxxxxxxxxxxxxxx"
      # -- global postgres master host
      host: "<postgres master host>"
      # -- global postgres master port
      port: "5432"
  # -- (string) Environment name.
  # This should be the same as vpcname if you're doing an AWS deployment.
  # Currently this is being used to share ALB's if you have multiple namespaces in same cluster.
  environment: default
  # -- (string) Hostname for the deployment.
  hostname: example.openstackhelm.org
  # -- (string) ARN of the reverse proxy certificate.
  revproxyArn: arn:aws:acm:us-east-1:123456:certificate
  # -- (string) URL of the data dictionary.
  dictionaryUrl: "https://dictionary-bucket.xxxxxxxx/xxxxxxxxxx.json"
  # -- (string) Portal application name.
  portalApp: gitops
  # -- (bool) Whether public datasets are enabled.
  publicDataSets: true
  # -- (string) Access level for tiers. acceptable values for `tier_access_level` are: `libre`, `regular` and `private`. If omitted, by default common will be treated as `private`
  tierAccessLevel: libre
  # -- (int) Only relevant if tireAccessLevel is set to "regular". Summary charts below this limit will not appear for aggregated data.
  tierAccessLimit: "1000"
  # -- (bool) Whether network policies are enabled.
  netPolicy: true
  # -- (int) Number of dispatcher jobs.
  dispatcherJobNum: "10"
  # -- (bool) Whether Datadog is enabled.
  ddEnabled: false
  # -- (map) If you would like to add any extra values to the manifest-global configmap.
  manifestGlobalExtraValues: {}
  # -- (map) External Secrets settings.
  externalSecrets:
    # -- (bool) Will use ExternalSecret resources to pull secrets from Secrets Manager instead of creating them locally. Be cautious as this will override secrets you have deployed.
    deploy: false
    # -- (bool) Will create the databases and store the creds in Kubernetes Secrets even if externalSecrets is deployed. Useful if you want to use ExternalSecrets for other secrets besides db secrets.
    dbCreate: false

# Dependancy Charts

ambassador:
  # -- (bool) Whether to deploy the ambassador subchart.
  enabled: false

arborist:
  # -- (bool) Whether to deploy the arborist subchart.
  enabled: true
  # -- (map) Docker image information.
  image:
    # -- (string) The Docker image repository for the arborist service.
    repository: "quay.io/cdis/arborist"
    # -- (string) Overrides the image tag whose default is the chart appVersion.
    tag: "2023.06"

argo-wrapper:
  # -- (bool) Whether to deploy the argo-wrapper subchart.
  enabled: false

audit:
  # -- (bool) Whether to deploy the audit subchart.
  enabled: true
  image:
  # -- (string) The Docker image repository for the audit service
  repository: quay.io/cdis/audit-service
  # -- (string) When to pull the image. This value should be "Always" to ensure the latest image is used.
  tag: "2023.06"


aws-es-proxy:
  # -- (bool) Whether to deploy the aws-es-proxy subchart.
  enabled: false
  # -- (str) Elasticsearch endpoint in AWS
  esEndpoint: test.us-east-1.es.amazonaws.com
  # -- (map) Secret information
  secrets:
    # -- (str) AWS access key ID for aws-es-proxy
    awsAccessKeyId: ""
    # -- (str) AWS secret access key for aws-es-proxy
    awsSecretAccessKey: ""

etl:
  # -- (bool) Whether to deploy the etl subchart.
  enabled: true
  image:
    tube:
      # -- (string) The Docker image repository for the fence service
      repository: quay.io/cdis/tube
      # -- (string) When to pull the image. This value should be "Always" to ensure the latest image is used.
      # -- (string) Overrides the image tag whose default is the chart appVersion.
      tag: "master"
    spark:
      # -- (string) The Docker image repository for the spark service
      repository: quay.io/cdis/gen3-spark
      # -- (string) When to pull the image. This value should be "Always" to ensure the latest image is used.
      # -- (string) Overrides the image tag whose default is the chart appVersion.
      tag: "master"

fence:
  # -- (bool) Whether to deploy the fence subchart.
  enabled: true
  # -- (map) Docker image information.
  image:
    # -- (string) The Docker image repository for the fence service.
    repository: "quay.io/cdis/fence"
    # -- (string) Overrides the image tag whose default is the chart appVersion.
    tag: "2023.06"
  FENCE_CONFIG: 
  # -- (string) USER YAML. Passed in as a multiline string.
    APP_NAME: 'Gen3 Data Commons'
    # A URL-safe base64-encoded 32-byte key for encrypting keys in db
    # in python you can use the following script to generate one:
    #     import base64
    #     import os
    #     key = base64.urlsafe_b64encode(os.urandom(32))
    #     print(key)
    ENCRYPTION_KEY: REPLACEME
    DEBUG: True
    OPENID_CONNECT:
      google:
        client_id: "xxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com"
        client_secret: "XXXXXX-XXXXX-XXXXXX"

  usersync:
    # -- (bool) Whether to run Fence usersync or not.
    usersync: false
    # -- (string) The cron schedule expression to use in the usersync cronjob. Runs every 30 minutes by default.
    schedule: "*/30 * * * *"
    # -- (bool) Whether to sync data from dbGaP.
    syncFromDbgap: false
    # -- (bool) Force attempting a dbgap sync if "true", falls back on user.yaml
    addDbgap: false
    # -- (bool) Forces ONLY a dbgap sync if "true", IGNORING user.yaml
    onlyDbgap: false
    # -- (string) Path to the user.yaml file in S3.
    userYamlS3Path: s3://cdis-gen3-users/helm-test/user.yaml
    # -- (string) Slack webhook endpoint used with certain jobs.
    slack_webhook: None
    # -- (bool) Will echo what files we are seeing on dbgap ftp to Slack.
    slack_send_dbgap: false

guppy:
  # -- (bool) Whether to deploy the guppy subchart.
  enabled: yes
  # -- (map) Docker image information.
  image:
    # -- (string) The Docker image repository for the guppy service.
    repository: "quay.io/cdis/guppy"
    # -- (string) Overrides the image tag whose default is the chart appVersion.
    tag: "2023.06"
hatchery:
  # -- (bool) Whether to deploy the hatchery subchart.
  enabled: false

  hatchery:
    sidecarContainer:
      # -- (string) The maximum amount of CPU the sidecar container can use
      cpu-limit: '0.1'
      # -- (string) The maximum amount of memory the sidecar container can use
      memory-limit: 256Mi
      # -- (string) The sidecar image.
      image: quay.io/cdis/ecs-ws-sidecar:master
      # -- (map) Environment variables to pass to the sidecar container
      env:
        NAMESPACE: "{{ .Release.Namespace }}"
        HOSTNAME: "{{ .Values.global.hostname }}"
      # -- (list) Arguments to pass to the sidecare container.
      args: []
      # -- (list) Commands to run for the sidecar container.
      command:
      - "/bin/bash"
      - "./sidecar.sh"
      lifecycle-pre-stop:
      - su
      - "-c"
      - echo test
      - "-s"
      - "/bin/sh"
      - root
    containers:
      -
        # -- (int) port to proxy traffic to in docker contaniner
        target-port: 8888
        # -- (string) cpu limit of workspace container
        cpu-limit: '1.0'
        # -- (string) memory limit of workspace container
        memory-limit: 2Gi
        # -- (string) name of workspace
        name: "(Tutorials) Example Analysis Jupyter Lab Notebooks"
        # -- (string) docker image for workspace
        image: quay.io/cdis/heal-notebooks:combined_tutorials__latest
        # -- environment variables for workspace container
        env:
          FRAME_ANCESTORS: https://{{ .Values.global.hostname }}
        args:
        - "--NotebookApp.base_url=/lw-workspace/proxy/"
        - "--NotebookApp.default_url=/lab"
        - "--NotebookApp.password=''"
        - "--NotebookApp.token=''"
        - "--NotebookApp.shutdown_no_activity_timeout=5400"
        - "--NotebookApp.quit_button=False"
        command:
        - start-notebook.sh
        path-rewrite: "/lw-workspace/proxy/"
        use-tls: 'false'
        ready-probe: "/lw-workspace/proxy/"
        lifecycle-post-start:
        - "/bin/sh"
        - "-c"
        - export IAM=`whoami`; rm -rf /home/$IAM/pd/dockerHome; rm -rf /home/$IAM/pd/lost+found;
          ln -s /data /home/$IAM/pd/; true
        user-uid: 1000
        fs-gid: 100
        user-volume-location: "/home/jovyan/pd"
        gen3-volume-location: "/home/jovyan/.gen3"


indexd:
  # -- (bool) Whether to deploy the indexd subchart.
  enabled: true
  # -- (map) Docker image information.
  image:
    # -- (string) The Docker image repository for the indexd service.
    repository: "quay.io/cdis/indexd"
    # -- (string) Overrides the image tag whose default is the chart appVersion.
    tag: "2023.06"
  # -- (string) the default prefix for indexd records
  defaultPrefix: "PREFIX/"


manifestservice:
  # -- (bool) Whether to deploy the manifest service subchart.
  enabled: true
  # -- (map) Docker image information.
  image:
    # -- (string) Docker repository.
    repository: quay.io/cdis/manifestservice
    # -- (string) Docker pull policy.
    pullPolicy: Always
    # -- (string) Overrides the image tag whose default is the chart appVersion.
    tag: "2023.06"

metadata:
  # -- (bool) Whether to deploy the metadata subchart.
  enabled: false

peregrine:
  # -- (bool) Whether to deploy the peregrine subchart.
  enabled: true
  # -- (map) Docker image information.
  image:
    # -- (string) The Docker image repository for the peregrine service.
    repository: "quay.io/cdis/peregrine"
    # -- (string) Overrides the image tag whose default is the chart appVersion.
    tag: "2023.06"

pidgin:
  # -- (bool) Whether to deploy the pidgin subchart.
  enabled: true
  # -- (map) Docker image information.
  image:
    # -- (string) The Docker image repository for the pidgin service.
    repository: "quay.io/cdis/pidgin"
    # -- (string) Overrides the image tag whose default is the chart appVersion.
    tag: "2023.06"

portal:
  # -- (bool) Whether to deploy the portal subchart.
  enabled: true
  # -- (map) Docker image information.
  image: 
    # -- (string) The Docker image repository for the portal service.
    repository: "<The Docker image repository>"
    # -- (string) Overrides the image tag whose default is the chart appVersion.
    tag: "<tag>"
  # -- (map) GitOps configuration for portal
  imagePullSecrets: 
   - name: ""

requestor:
  # -- (bool) Whether to deploy the requestor subchart.
  enabled: false

revproxy:
  # -- (bool) Whether to deploy the revproxy subchart.
  enabled: true
  # -- (map) Docker image information.
  image:
    # -- (string) The Docker image repository for the revproxy service.
    repository: "quay.io/cdis/nginx"
    # -- (string) Overrides the image tag whose default is the chart appVersion.
    tag: "2023.06"

  ingress:
    # -- (bool) Whether to create the custom revproxy ingress
    enabled: false
    # -- (map) Annotations to add to the ingress.
    annotations: {}
      # kubernetes.io/ingress.class: nginx
      # kubernetes.io/tls-acme: "true"
    # -- (list) Where to route the traffic.
    hosts:
      - host: chart-example.local
    # -- (list) To secure an Ingress by specifying a secret that contains a TLS private key and certificate.
    tls: []

sheepdog:
  # -- (bool) Whether to deploy the sheepdog subchart.
  enabled: true
  # -- (map) Docker image information.
  image:
    # -- (string) The Docker image repository for the sheepdog service.
    repository: "quay.io/cdis/sheepdog"
    # -- (string) Overrides the image tag whose default is the chart appVersion.
    tag: "helm-test"

ssjdispatcher:
  # -- (bool) Whether to deploy the ssjdispatcher subchart.
  enabled: false

wts:
  # -- (bool) Whether to deploy the wts subchart.
  enabled: false

# Disable persistence by default so we can spin up and down ephemeral environments
postgresql:
  primary:
    persistence:
      # -- (bool) Option to persist the dbs data.
      enabled: false
elasticsearch:
  # -- (bool) Whether to deploy the aws-es-proxy subchart.
  enabled: true
  image:
    repository: quay.io/cdis/elasticsearch
   # Overrides the image tag whose default is the chart appVersion.
    tag: "feat_es_dockerfile"