{{- if and (.Values.global.externalSecrets.deploy) (.Values.externalSecrets.pushGen3WorkflowSecretsToExternalSecret) }}
apiVersion: external-secrets.io/v1alpha1
kind: PushSecret
metadata:
  name: push-gen3workflow-g3auto
spec:
  refreshInterval: 1m
  updatePolicy: IfNotExists
  secretStoreRefs:
  {{- if ne .Values.global.externalSecrets.clusterSecretStoreRef "" }}
    - name: {{ .Values.global.externalSecrets.clusterSecretStoreRef }}
      kind: ClusterSecretStore
  {{- else }}
    - name: {{include "common.SecretStore" .}}
      kind: SecretStore
  {{- end }}
  selector:
    secret:
      name: gen3workflow-g3auto
  data:
    - match:
        secretKey: gen3-workflow-config.yaml
        remoteRef:
          remoteKey: {{ include "gen3workflow-g3auto" . }}
          property: gen3-workflow-config.yaml
---
apiVersion: external-secrets.io/v1alpha1
kind: PushSecret
metadata:
  name: push-funnel-oidc-client
spec:
  refreshInterval: 5m
  updatePolicy: IfNotExists
  secretStoreRefs:
    {{- if ne .Values.global.externalSecrets.clusterSecretStoreRef "" }}
    - name: {{ .Values.global.externalSecrets.clusterSecretStoreRef }}
      kind: ClusterSecretStore
    {{- else }}
    - name: {{include "common.SecretStore" .}}
      kind: SecretStore
    {{- end }}
  selector:
    secret:
      name:  funnel-oidc-client
  data:
    - match:
        remoteRef:
          remoteKey: {{ include "funnel-oidc-client" . }}
{{- end }}