{{- if and (.Values.global.externalSecrets.deploy) (.Values.externalSecrets.pushGen3WorkflowSecretsToExternalSecret) }}
apiVersion: external-secrets.io/v1beta1
kind: PushSecret
metadata:
  name: push-gen3workflow-g3auto
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: {{ include "common.SecretStore" . }}
    kind: SecretStore
  sourceRef:
    kind: Secret
    name: gen3workflow-g3auto
  data:
    - match:
        secretKey: gen3-workflow-config.yaml
        remoteRef:
          key: {{ include "gen3workflow-g3auto" . }}
          property: gen3-workflow-config.yaml
    - match:
        secretKey: funnel.conf
        remoteRef:
          key: {{ include "gen3workflow-g3auto" . }}
          property: funnel.conf
{{- end }}