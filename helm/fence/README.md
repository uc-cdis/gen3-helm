# fence

![Version: 0.1.6](https://img.shields.io/badge/Version-0.1.6-informational?style=flat-square) ![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square) ![AppVersion: master](https://img.shields.io/badge/AppVersion-master-informational?style=flat-square)

A Helm chart for gen3 Fence

## Requirements

| Repository | Name | Version |
|------------|------|---------|
| file://../common | common | 0.1.5 |
| https://charts.bitnami.com/bitnami | postgresql | 11.9.13 |

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| FENCE_CONFIG | map | `{"ACCESS_TOKEN_COOKIE_NAME":"access_token","ACCESS_TOKEN_EXPIRES_IN":1200,"ALLOWED_USER_SERVICE_ACCOUNT_DOMAINS":["developer.gserviceaccount.com","appspot.gserviceaccount.com","iam.gserviceaccount.com"],"ALLOW_GOOGLE_LINKING":true,"APPLICATION_ROOT":"/user","APP_NAME":"Gen3 Data Commons","ARBORIST":null,"ASSUME_ROLE_CACHE_SECONDS":1800,"AUDIT_SERVICE":"http://audit-service","AUTHLIB_INSECURE_TRANSPORT":true,"AWS_CREDENTIALS":{},"AZ_BLOB_CONTAINER_URL":"https://myfakeblob.blob.core.windows.net/my-fake-container/","AZ_BLOB_CREDENTIALS":null,"BILLING_PROJECT_FOR_SA_CREDS":null,"BILLING_PROJECT_FOR_SIGNED_URLS":null,"CIRRUS_CFG":{"GOOGLE_ADMIN_EMAIL":"","GOOGLE_API_KEY":"","GOOGLE_APPLICATION_CREDENTIALS":"","GOOGLE_CLOUD_IDENTITY_ADMIN_EMAIL":"","GOOGLE_IDENTITY_DOMAIN":"","GOOGLE_PROJECT_ID":"","GOOGLE_STORAGE_CREDS":""},"CLIENT_ALLOWED_SCOPES":["openid","user","data","google_credentials","google_service_account","google_link","ga4gh_passport_v1"],"DATA_UPLOAD_BUCKET":"bucket1","DBGAP_ACCESSION_WITH_CONSENT_REGEX":"(?P<phsid>phs[0-9]+)(.(?P<version>v[0-9]+)){0,1}(.(?P<participant_set>p[0-9]+)){0,1}.(?P<consent>c[0-9]+)","DEBUG":false,"DEFAULT_LOGIN_IDP":"google","DEFAULT_LOGIN_URL":"{{BASE_URL}}/login/google","DEV_LOGIN_COOKIE_NAME":"dev_login","DREAM_CHALLENGE_GROUP":"DREAM","DREAM_CHALLENGE_TEAM":"DREAM","EMAIL_SERVER":"localhost","ENABLED_IDENTITY_PROVIDERS":{},"ENABLE_AUDIT_LOGS":{"login":false,"presigned_url":false},"ENABLE_AUTOMATIC_BILLING_PERMISSION_SA_CREDS":false,"ENABLE_AUTOMATIC_BILLING_PERMISSION_SIGNED_URLS":false,"ENABLE_CSRF_PROTECTION":true,"ENABLE_DB_MIGRATION":true,"ENABLE_PROMETHEUS_METRICS":false,"ENCRYPTION_KEY":"REPLACEME","GA4GH_VISA_ISSUER_ALLOWLIST":["{{BASE_URL}}","https://sts.nih.gov","https://stsstg.nih.gov"],"GEN3_PASSPORT_EXPIRES_IN":43200,"GLOBAL_PARSE_VISAS_ON_LOGIN":null,"GOOGLE_ACCOUNT_ACCESS_EXPIRES_IN":86400,"GOOGLE_BULK_UPDATES":false,"GOOGLE_GROUP_PREFIX":"","GOOGLE_MANAGED_SERVICE_ACCOUNT_DOMAINS":["dataflow-service-producer-prod.iam.gserviceaccount.com","cloudbuild.gserviceaccount.com","cloud-ml.google.com.iam.gserviceaccount.com","container-engine-robot.iam.gserviceaccount.com","dataflow-service-producer-prod.iam.gserviceaccount.com","sourcerepo-service-accounts.iam.gserviceaccount.com","dataproc-accounts.iam.gserviceaccount.com","gae-api-prod.google.com.iam.gserviceaccount.com","genomics-api.google.com.iam.gserviceaccount.com","containerregistry.iam.gserviceaccount.com","container-analysis.iam.gserviceaccount.com","cloudservices.gserviceaccount.com","stackdriver-service.iam.gserviceaccount.com","appspot.gserviceaccount.com","partnercontent.gserviceaccount.com","trifacta-gcloud-prod.iam.gserviceaccount.com","gcf-admin-robot.iam.gserviceaccount.com","compute-system.iam.gserviceaccount.com","gcp-sa-websecurityscanner.iam.gserviceaccount.com","storage-transfer-service.iam.gserviceaccount.com","firebase-sa-management.iam.gserviceaccount.com","firebase-rules.iam.gserviceaccount.com","gcp-sa-cloudbuild.iam.gserviceaccount.com","gcp-sa-automl.iam.gserviceaccount.com","gcp-sa-datalabeling.iam.gserviceaccount.com","gcp-sa-cloudscheduler.iam.gserviceaccount.com"],"GOOGLE_SERVICE_ACCOUNT_KEY_FOR_URL_SIGNING_EXPIRES_IN":2592000,"GOOGLE_SERVICE_ACCOUNT_PREFIX":"","GOOGLE_USER_SERVICE_ACCOUNT_ACCESS_EXPIRES_IN":604800,"GUN_MAIL":{"datacommons.io":{"api_key":"","api_url":"https://api.mailgun.net/v3/mailgun.example.com","default_login":"postmaster@mailgun.example.com","smtp_hostname":"smtp.mailgun.org","smtp_password":""}},"HTTP_PROXY":{"host":null,"port":3128},"INDEXD":null,"INDEXD_PASSWORD":"","INDEXD_USERNAME":"fence","ITRUST_GLOBAL_LOGOUT":"https://auth.nih.gov/siteminderagent/smlogout.asp?mode=nih&AppReturnUrl=","LOGIN_OPTIONS":[{"desc":"description","idp":"google","name":"Login from Google"}],"LOGIN_REDIRECT_WHITELIST":[],"MAX_ACCESS_TOKEN_TTL":3600,"MAX_API_KEY_TTL":2592000,"MAX_PRESIGNED_URL_TTL":3600,"MAX_ROLE_SESSION_INCREASE":false,"MOCK_AUTH":false,"MOCK_GOOGLE_AUTH":false,"MOCK_STORAGE":false,"OAUTH2_JWT_ALG":"RS256","OAUTH2_JWT_ENABLED":true,"OAUTH2_JWT_ISS":"{{BASE_URL}}","OAUTH2_PROVIDER_ERROR_URI":"/api/oauth2/errors","OAUTH2_TOKEN_EXPIRES_IN":{"authorization_code":1200,"implicit":1200},"OPENID_CONNECT":{"cilogon":{"client_id":"","client_secret":"","discovery_url":"https://cilogon.org/.well-known/openid-configuration","mock":false,"mock_default_user":"http://cilogon.org/serverT/users/64703","redirect_url":"{{BASE_URL}}/login/cilogon/login/","scope":"openid email profile"},"cognito":{"client_id":"","client_secret":"","discovery_url":"https://cognito-idp.{REGION}.amazonaws.com/{USER-POOL-ID}/.well-known/openid-configuration","redirect_url":"{{BASE_URL}}/login/cognito/login/","scope":"openid email"},"fence":{"access_token_url":"{{api_base_url}}/oauth2/token","api_base_url":"","authorize_url":"{{api_base_url}}/oauth2/authorize","client_id":"","client_kwargs":{"redirect_uri":"{{BASE_URL}}/login/fence/login","scope":"openid"},"client_secret":"","mock":false,"mock_default_user":"test@example.com","name":"","refresh_token_url":"{{api_base_url}}/oauth2/token","shibboleth_discovery_url":"https://login.bionimbus.org/Shibboleth.sso/DiscoFeed"},"generic_oidc_idp":{"client_id":"","client_secret":"","discovery":{"authorization_endpoint":"","jwks_uri":"","token_endpoint":""},"discovery_url":"https://server.com/.well-known/openid-configuration","email_field":"","name":"some_idp","redirect_url":"{{BASE_URL}}/login/some_idp/login","scope":"","user_id_field":""},"google":{"client_id":"","client_secret":"","discovery_url":"https://accounts.google.com/.well-known/openid-configuration","mock":"","mock_default_user":"test@example.com","redirect_url":"{{BASE_URL}}/login/google/login/","scope":"openid email"},"microsoft":{"client_id":"","client_secret":"","discovery_url":"https://login.microsoftonline.com/organizations/v2.0/.well-known/openid-configuration","mock":false,"mock_default_user":"test@example.com","redirect_url":"{{BASE_URL}}/login/microsoft/login/","scope":"openid email"},"okta":{"client_id":"","client_secret":"","discovery_url":"","redirect_url":"{{BASE_URL}}/login/okta/login/","scope":"openid email"},"orcid":{"client_id":"","client_secret":"","discovery_url":"https://orcid.org/.well-known/openid-configuration","mock":false,"mock_default_user":"0000-0002-2601-8132","redirect_url":"{{BASE_URL}}/login/orcid/login/","scope":"openid"},"ras":{"client_id":"","client_secret":"","discovery_url":"https://sts.nih.gov/.well-known/openid-configuration","mock":false,"mock_default_user":"test@example.com","redirect_url":"{{BASE_URL}}/login/ras/callback","scope":"openid email profile ga4gh_passport_v1"},"shibboleth":{"client_id":"","client_secret":"","redirect_url":"{{BASE_URL}}/login/shib/login"},"synapse":{"client_id":"","client_secret":"","discovery_url":"","redirect_url":"","scope":"openid"}},"OVERRIDE_NGINX_RATE_LIMIT":18,"PRIVACY_POLICY_URL":null,"PROBLEM_USER_EMAIL_NOTIFICATION":{"admin":["admin@example.edu"],"content":"The Data Commons Framework utilizes dbGaP for data access authorization. Another member of a Google project you belong to ({}) is attempting to register a service account to the following additional datasets ({}). Please contact dbGaP to request access.\n","domain":"example.com","from":"do-not-reply@example.com","subject":"Account access error notification"},"PUSH_AUDIT_LOGS_CONFIG":{"aws_sqs_config":{"aws_cred":null,"region":null,"sqs_url":null},"type":"aws_sqs"},"RAS_REFRESH_EXPIRATION":1296000,"RAS_USERINFO_ENDPOINT":"/openid/connect/v1.1/userinfo","REFRESH_TOKEN_EXPIRES_IN":2592000,"REGISTERED_USERS_GROUP":"","REGISTER_USERS_ON":false,"REMOVE_SERVICE_ACCOUNT_EMAIL_NOTIFICATION":{"admin":["admin@example.edu"],"content":"Service accounts were removed from access control data because some users or service accounts of GCP Project {} are not authorized to access the data sets associated to the service accounts, or do not adhere to the security policies.\n","domain":"example.com","enable":false,"from":"do-not-reply@example.com","subject":"User service account removal notification"},"RENEW_ACCESS_TOKEN_BEFORE_EXPIRATION":false,"S3_BUCKETS":{},"SEND_FROM":"example@gmail.com","SEND_TO":"example@gmail.com","SERVICE_ACCOUNT_LIMIT":6,"SESSION_ALLOWED_SCOPES":["openid","user","credentials","data","admin","google_credentials","google_service_account","google_link","ga4gh_passport_v1"],"SESSION_COOKIE_DOMAIN":null,"SESSION_COOKIE_NAME":"fence","SESSION_COOKIE_SECURE":true,"SESSION_LIFETIME":28800,"SESSION_TIMEOUT":1800,"SHIBBOLETH_HEADER":"persistent_id","SSO_URL":"https://auth.nih.gov/affwebservices/public/saml2sso?SPID={{BASE_URL}}/shibboleth&RelayState=","STORAGE_CREDENTIALS":{},"SUPPORT_EMAIL_FOR_ERRORS":null,"SYNAPSE_AUTHZ_TTL":86400,"SYNAPSE_DISCOVERY_URL":null,"SYNAPSE_JWKS_URI":null,"SYNAPSE_URI":"https://repo-prod.prod.sagebase.org/auth/v1","TOKEN_PROJECTS_CUTOFF":10,"USERSYNC":{"fallback_to_dbgap_sftp":false,"sync_from_visas":false,"visa_types":{"ras":["https://ras.nih.gov/visas/v1","https://ras.nih.gov/visas/v1.1"]}},"USER_ALLOWED_SCOPES":["fence","openid","user","data","admin","google_credentials","google_service_account","google_link","ga4gh_passport_v1"],"WHITE_LISTED_GOOGLE_PARENT_ORGS":[],"WHITE_LISTED_SERVICE_ACCOUNT_EMAILS":[],"WTF_CSRF_SECRET_KEY":"{{ENCRYPTION_KEY}}","dbGaP":[{"decrypt_key":"","enable_common_exchange_area_access":false,"info":{"host":"","password":"","port":22,"proxy":"","proxy_user":"","username":""},"parse_consent_code":true,"protocol":"sftp","study_common_exchange_areas":{"example":"test_common_exchange_area"},"study_to_resource_namespaces":{"_default":["/"],"test_common_exchange_area":["/dbgap/"]}}]}` | Configuration settings for Fence app |
| FENCE_CONFIG.APP_NAME | string | `"Gen3 Data Commons"` | Name of the Fence app |
| FENCE_CONFIG.AUTHLIB_INSECURE_TRANSPORT | bool | `true` | allow OIDC traffic on http for development. By default it requires https.  WARNING: ONLY set to true when fence will be deployed in such a way that it will          ONLY receive traffic from internal clients and can safely use HTTP. |
| FENCE_CONFIG.CLIENT_ALLOWED_SCOPES | list | `["openid","user","data","google_credentials","google_service_account","google_link","ga4gh_passport_v1"]` | These are the *possible* scopes a client can be given, NOT scopes that are given to all clients. You can be more restrictive during client creation |
| FENCE_CONFIG.DEBUG | map | `false` | Debug and security settings Modify based on whether you're in a dev environment or in production |
| FENCE_CONFIG.DEFAULT_LOGIN_IDP | string | `"google"` | Default login provider. - must be configured in LOGIN_OPTIONS and OPENID_CONNECT - - if several options in LOGIN_OPTIONS are defined for this IDP, will default to the first one |
| FENCE_CONFIG.DEFAULT_LOGIN_URL | string | `"{{BASE_URL}}/login/google"` | Default login URL: DEPRECATED and replaced by LOGIN_OPTIONS + DEFAULT_LOGIN_IDP configs |
| FENCE_CONFIG.DEV_LOGIN_COOKIE_NAME | str | `"dev_login"` | the name of the cookie set by mock authentication (used for testing only) |
| FENCE_CONFIG.ENABLE_CSRF_PROTECTION | bool | `true` | enable CSRF protection |
| FENCE_CONFIG.ENABLE_DB_MIGRATION | bool | `true` | fence (at the moment) attempts a migration on startup. setting this to false will disable that WARNING: ONLY set to false if you do NOT want to automatically migrate your database.          You should be careful about incompatible versions of your db schema with what          fence expects. In other words, things could be broken if you update to a later          fence that expects a schema your database isn't migrated to. NOTE: We are working to improve the migration process in the near future |
| FENCE_CONFIG.ENABLE_PROMETHEUS_METRICS | bool | `false` | enable Prometheus Metrics for observability purposes  WARNING: Any counters, gauges, histograms, etc. should be carefully reviewed to make sure its labels do not contain any PII / PHI |
| FENCE_CONFIG.ENCRYPTION_KEY | string | `"REPLACEME"` | A URL-safe base64-encoded 32-byte key for encrypting keys in db in python you can use the following script to generate one:     import base64     import os     key = base64.urlsafe_b64encode(os.urandom(32))     print(key) |
| FENCE_CONFIG.LOGIN_OPTIONS | list | `[{"desc":"description","idp":"google","name":"Login from Google"}]` | List of enabled login options (used by data-portal to display login buttons). |
| FENCE_CONFIG.MOCK_AUTH | bool | `false` | if true, will automatically login a user with username "test" WARNING: DO NOT ENABLE IN PRODUCTION (for testing purposes only) |
| FENCE_CONFIG.MOCK_GOOGLE_AUTH | bool | `false` | if true, will fake a successful login response from Google in /login/google     NOTE: this will also modify the behavior of /link/google endpoints WARNING: DO NOT ENABLE IN PRODUCTION (for testing purposes only) will login as the username set in cookie DEV_LOGIN_COOKIE_NAME |
| FENCE_CONFIG.MOCK_STORAGE | bool | `false` | if true, will ignore anything configured in STORAGE_CREDENTIALS |
| FENCE_CONFIG.OPENID_CONNECT | dict | `{"cilogon":{"client_id":"","client_secret":"","discovery_url":"https://cilogon.org/.well-known/openid-configuration","mock":false,"mock_default_user":"http://cilogon.org/serverT/users/64703","redirect_url":"{{BASE_URL}}/login/cilogon/login/","scope":"openid email profile"},"cognito":{"client_id":"","client_secret":"","discovery_url":"https://cognito-idp.{REGION}.amazonaws.com/{USER-POOL-ID}/.well-known/openid-configuration","redirect_url":"{{BASE_URL}}/login/cognito/login/","scope":"openid email"},"fence":{"access_token_url":"{{api_base_url}}/oauth2/token","api_base_url":"","authorize_url":"{{api_base_url}}/oauth2/authorize","client_id":"","client_kwargs":{"redirect_uri":"{{BASE_URL}}/login/fence/login","scope":"openid"},"client_secret":"","mock":false,"mock_default_user":"test@example.com","name":"","refresh_token_url":"{{api_base_url}}/oauth2/token","shibboleth_discovery_url":"https://login.bionimbus.org/Shibboleth.sso/DiscoFeed"},"generic_oidc_idp":{"client_id":"","client_secret":"","discovery":{"authorization_endpoint":"","jwks_uri":"","token_endpoint":""},"discovery_url":"https://server.com/.well-known/openid-configuration","email_field":"","name":"some_idp","redirect_url":"{{BASE_URL}}/login/some_idp/login","scope":"","user_id_field":""},"google":{"client_id":"","client_secret":"","discovery_url":"https://accounts.google.com/.well-known/openid-configuration","mock":"","mock_default_user":"test@example.com","redirect_url":"{{BASE_URL}}/login/google/login/","scope":"openid email"},"microsoft":{"client_id":"","client_secret":"","discovery_url":"https://login.microsoftonline.com/organizations/v2.0/.well-known/openid-configuration","mock":false,"mock_default_user":"test@example.com","redirect_url":"{{BASE_URL}}/login/microsoft/login/","scope":"openid email"},"okta":{"client_id":"","client_secret":"","discovery_url":"","redirect_url":"{{BASE_URL}}/login/okta/login/","scope":"openid email"},"orcid":{"client_id":"","client_secret":"","discovery_url":"https://orcid.org/.well-known/openid-configuration","mock":false,"mock_default_user":"0000-0002-2601-8132","redirect_url":"{{BASE_URL}}/login/orcid/login/","scope":"openid"},"ras":{"client_id":"","client_secret":"","discovery_url":"https://sts.nih.gov/.well-known/openid-configuration","mock":false,"mock_default_user":"test@example.com","redirect_url":"{{BASE_URL}}/login/ras/callback","scope":"openid email profile ga4gh_passport_v1"},"shibboleth":{"client_id":"","client_secret":"","redirect_url":"{{BASE_URL}}/login/shib/login"},"synapse":{"client_id":"","client_secret":"","discovery_url":"","redirect_url":"","scope":"openid"}}` | Configurations for OpenID Connect (OIDC) authentication   - Fully configure at least one client so login works   - WARNING: Be careful changing the *_ALLOWED_SCOPES as you can break basic              and optional functionality |
| FENCE_CONFIG.OPENID_CONNECT.fence | dict | `{"access_token_url":"{{api_base_url}}/oauth2/token","api_base_url":"","authorize_url":"{{api_base_url}}/oauth2/authorize","client_id":"","client_kwargs":{"redirect_uri":"{{BASE_URL}}/login/fence/login","scope":"openid"},"client_secret":"","mock":false,"mock_default_user":"test@example.com","name":"","refresh_token_url":"{{api_base_url}}/oauth2/token","shibboleth_discovery_url":"https://login.bionimbus.org/Shibboleth.sso/DiscoFeed"}` | : Contains multi-tenant Fence configuration Support for multi-tenant fence (another fence is this fence's IDP) If this fence instance is a client of another fence, fill this cfg out. REMOVE if not needed |
| FENCE_CONFIG.OPENID_CONNECT.fence.access_token_url | str | `"{{api_base_url}}/oauth2/token"` | : URL for access token endpoint of the other fence |
| FENCE_CONFIG.OPENID_CONNECT.fence.api_base_url | str | `""` | : Root URL for the other fence this api_base_url should be the root url for the OTHER fence something like: https://example.com |
| FENCE_CONFIG.OPENID_CONNECT.fence.authorize_url | str | `"{{api_base_url}}/oauth2/authorize"` | : URL for authorization endpoint of the other fence The next 3 should not need to be changed if the provider is following Oauth2 endpoint naming conventions |
| FENCE_CONFIG.OPENID_CONNECT.fence.client_id | str | `""` | : ID of the client of this fence on the other fence this client_id and client_secret should be obtained by registering THIS fence as a new client of the OTHER fence |
| FENCE_CONFIG.OPENID_CONNECT.fence.client_kwargs | object | `{"redirect_uri":"{{BASE_URL}}/login/fence/login","scope":"openid"}` | dict: Additional client parameters |
| FENCE_CONFIG.OPENID_CONNECT.fence.client_kwargs.redirect_uri | str | `"{{BASE_URL}}/login/fence/login"` | : The URL to which the other fence will redirect after logging in |
| FENCE_CONFIG.OPENID_CONNECT.fence.client_kwargs.scope | str | `"openid"` | : Space-separated string of scopes openid is required to use OIDC flow |
| FENCE_CONFIG.OPENID_CONNECT.fence.client_secret | str | `""` | : Secret of the client of this fence on the other fence |
| FENCE_CONFIG.OPENID_CONNECT.fence.mock | bool | `false` | : Whether to mock a successful login response for testing purposes if mock is true, will fake a successful login response for login WARNING: DO NOT ENABLE IN PRODUCTION (for testing purposes only) |
| FENCE_CONFIG.OPENID_CONNECT.fence.mock_default_user | str | `"test@example.com"` | : Default user for mock login |
| FENCE_CONFIG.OPENID_CONNECT.fence.name | str | `""` | : Name of the provider for consent screens Custom name to display for consent screens. If not provided, will use `fence`. If the other fence is using NIH Login, you should make name: `NIH Login` |
| FENCE_CONFIG.OPENID_CONNECT.fence.refresh_token_url | str | `"{{api_base_url}}/oauth2/token"` | : URL for refresh token endpoint of the other fence |
| FENCE_CONFIG.OPENID_CONNECT.fence.shibboleth_discovery_url | str | `"https://login.bionimbus.org/Shibboleth.sso/DiscoFeed"` | : URL of the shibboleth discovery endpoint if needed for InCommon login this is needed to enable InCommon login, if some LOGIN_OPTIONS are configured with idp=fence and a list of shib_idps: |
| FENCE_CONFIG.OPENID_CONNECT.generic_oidc_idp.client_id | str | `""` | Client ID |
| FENCE_CONFIG.OPENID_CONNECT.generic_oidc_idp.client_secret | str | `""` | Client secret |
| FENCE_CONFIG.OPENID_CONNECT.generic_oidc_idp.discovery.authorization_endpoint | str | `""` | Authorization endpoint URL |
| FENCE_CONFIG.OPENID_CONNECT.generic_oidc_idp.discovery.jwks_uri | str | `""` | JSON Web Key Set (JWKS) URI |
| FENCE_CONFIG.OPENID_CONNECT.generic_oidc_idp.discovery.token_endpoint | str | `""` | Token endpoint URL |
| FENCE_CONFIG.OPENID_CONNECT.generic_oidc_idp.discovery_url | str | `"https://server.com/.well-known/openid-configuration"` | URL of the OIDC discovery endpoint for the IDP |
| FENCE_CONFIG.OPENID_CONNECT.generic_oidc_idp.email_field | str | `""` | Optional; claims field to get the user email from (default "email") |
| FENCE_CONFIG.OPENID_CONNECT.generic_oidc_idp.name | str | `"some_idp"` | Optional; display name for this IDP |
| FENCE_CONFIG.OPENID_CONNECT.generic_oidc_idp.redirect_url | str | `"{{BASE_URL}}/login/some_idp/login"` | Redirect URL for this IDP |
| FENCE_CONFIG.OPENID_CONNECT.generic_oidc_idp.scope | str | `""` | Optional; default is "openid" |
| FENCE_CONFIG.OPENID_CONNECT.generic_oidc_idp.user_id_field | str | `""` | Optional; claims field to get the user_id from (default "sub") |
| FENCE_CONFIG.OPENID_CONNECT.google | dict | `{"client_id":"","client_secret":"","discovery_url":"https://accounts.google.com/.well-known/openid-configuration","mock":"","mock_default_user":"test@example.com","redirect_url":"{{BASE_URL}}/login/google/login/","scope":"openid email"}` | Configuration for Google authentication provider |
| FENCE_CONFIG.OPENID_CONNECT.google.client_id | str | `""` | Client ID |
| FENCE_CONFIG.OPENID_CONNECT.google.client_secret | str | `""` | Client secret |
| FENCE_CONFIG.OPENID_CONNECT.google.discovery_url | str | `"https://accounts.google.com/.well-known/openid-configuration"` | URL of the OIDC discovery endpoint for Google |
| FENCE_CONFIG.OPENID_CONNECT.google.mock | str | `""` | Optional; defaults to '{{MOCK_GOOGLE_AUTH}}' for backwards compatibility with older cfg files |
| FENCE_CONFIG.OPENID_CONNECT.google.mock_default_user | str | `"test@example.com"` | Optional; defaults to 'test@example.com' |
| FENCE_CONFIG.OPENID_CONNECT.google.redirect_url | str | `"{{BASE_URL}}/login/google/login/"` | The allowed redirect back to fence, should not need to change |
| FENCE_CONFIG.OPENID_CONNECT.google.scope | str | `"openid email"` | The scope to request from Google (default "openid email") |
| FENCE_CONFIG.SESSION_ALLOWED_SCOPES | list | `["openid","user","credentials","data","admin","google_credentials","google_service_account","google_link","ga4gh_passport_v1"]` | these are the scopes that a browser session can create for a user (very similar to USER_ALLOWED_SCOPES, as the session will actually create access_tokens for an actively logged in user) |
| FENCE_CONFIG.SESSION_COOKIE_SECURE | bool | `true` | set if you want browsers to only send cookies with requests over HTTPS |
| FENCE_CONFIG.USER_ALLOWED_SCOPES | list | `["fence","openid","user","data","admin","google_credentials","google_service_account","google_link","ga4gh_passport_v1"]` | these are the scopes that CAN be included in a user's own access_token |
| FENCE_CONFIG.WTF_CSRF_SECRET_KEY | str | `"{{ENCRYPTION_KEY}}"` | signing key for WTForms to sign CSRF tokens with |
| USER_YAML | string | `"cloud_providers: {}\ngroups: {}\nauthz:\n  # policies automatically given to anyone, even if they haven't authenticated\n  anonymous_policies: ['open_data_reader', 'full_open_access']\n\n  # policies automatically given to authenticated users (in addition to their other\n  # policies)\n  all_users_policies: ['open_data_reader', 'authn_open_access']\n\n  user_project_to_resource:\n    QA: /programs/QA\n    DEV: /programs/DEV\n    test: /programs/QA/projects/test\n    jenkins: /programs/jnkns/projects/jenkins\n    jenkins2: /programs/jnkns/projects/jenkins2\n    jnkns: /programs/jnkns\n\n  policies:\n    # General Access\n    - id: 'workspace'\n      description: 'be able to use workspace'\n      resource_paths: ['/workspace']\n      role_ids: ['workspace_user']\n    - id: 'dashboard'\n      description: 'be able to use the commons dashboard'\n      resource_paths: ['/dashboard']\n      role_ids: ['dashboard_user']\n    - id: 'prometheus'\n      description: 'be able to use prometheus'\n      resource_paths: ['/prometheus']\n      role_ids: ['prometheus_user']\n    - id: 'ttyadmin'\n      description: 'be able to use the admin tty'\n      resource_paths: ['/ttyadmin']\n      role_ids: ['ttyadmin_user']\n    - id: 'mds_admin'\n      description: 'be able to use metadata service'\n      resource_paths: ['/mds_gateway']\n      role_ids: ['mds_user']\n    - id: 'data_upload'\n      description: 'upload raw data files to S3'\n      role_ids: ['file_uploader']\n      resource_paths: ['/data_file']\n    - description: be able to use sower job\n      id: sower\n      resource_paths: [/sower]\n      role_ids: [sower_user]\n    - id: 'mariner_admin'\n      description: 'full access to mariner API'\n      resource_paths: ['/mariner']\n      role_ids: ['mariner_admin']\n    - id: audit_reader\n      role_ids:\n      - audit_reader\n      resource_paths:\n      - /services/audit\n    - id: audit_login_reader\n      role_ids:\n      - audit_reader\n      resource_paths:\n      - /services/audit/login\n    - id: audit_presigned_url_reader\n      role_ids:\n      - audit_reader\n      resource_paths:\n      - /services/audit/presigned_url\n    - id: requestor_admin\n      role_ids:\n      - requestor_admin\n      resource_paths:\n      - /programs\n    - id: requestor_reader\n      role_ids:\n      - requestor_reader\n      resource_paths:\n      - /programs\n    - id: requestor_creator\n      role_ids:\n      - requestor_creator\n      resource_paths:\n      - /programs\n    - id: requestor_updater\n      role_ids:\n      - requestor_updater\n      resource_paths:\n      - /programs\n    - id: requestor_deleter\n      role_ids:\n      - requestor_deleter\n      resource_paths:\n      - /programs\n    # Data Access\n\n    # All programs policy\n    - id: 'all_programs_reader'\n      description: ''\n      role_ids:\n        - 'reader'\n        - 'storage_reader'\n      resource_paths: ['/programs']\n\n    # # example if need access to write to storage\n    # - id: 'programs.jnkns-storage_writer'\n    #   description: ''\n    #   role_ids:\n    #     - 'storage_writer'\n    #   resource_paths: ['/programs/jnkns']\n\n    - id: 'programs.jnkns-admin'\n      description: ''\n      role_ids:\n        - 'creator'\n        - 'reader'\n        - 'updater'\n        - 'deleter'\n        - 'storage_reader'\n      resource_paths:\n        - '/programs/jnkns'\n        - '/gen3/programs/jnkns'\n\n    - id: 'programs.jnkns-viewer'\n      description: ''\n      role_ids:\n        - 'reader'\n        - 'storage_reader'\n      resource_paths:\n        - '/programs/jnkns'\n        - '/gen3/programs/jnkns'\n\n\n    - id: 'programs.QA-admin'\n      description: ''\n      role_ids:\n        - 'creator'\n        - 'reader'\n        - 'updater'\n        - 'deleter'\n        - 'storage_reader'\n      resource_paths:\n        - '/programs/QA'\n        - '/gen3/programs/QA'\n\n    - id: 'programs.QA-admin-no-storage'\n      description: ''\n      role_ids:\n        - 'creator'\n        - 'reader'\n        - 'updater'\n        - 'deleter'\n      resource_paths:\n        - '/programs/QA'\n        - '/gen3/programs/QA'\n\n    - id: 'programs.QA-viewer'\n      description: ''\n      role_ids:\n        - 'reader'\n        - 'storage_reader'\n      resource_paths:\n        - '/programs/QA'\n        - '/gen3/programs/QA'\n\n    - id: 'programs.DEV-admin'\n      description: ''\n      role_ids:\n        - 'creator'\n        - 'reader'\n        - 'updater'\n        - 'deleter'\n        - 'storage_reader'\n        - 'storage_writer'\n      resource_paths:\n        - '/programs/DEV'\n        - '/gen3/programs/DEV'\n\n    - id: 'programs.DEV-storage_writer'\n      description: ''\n      role_ids:\n        - 'storage_writer'\n      resource_paths: ['/programs/DEV']\n\n    - id: 'programs.DEV-viewer'\n      description: ''\n      role_ids:\n        - 'reader'\n        - 'storage_reader'\n      resource_paths:\n        - '/programs/DEV'\n        - '/gen3/programs/DEV'\n\n    - id: 'programs.test-admin'\n      description: ''\n      role_ids:\n        - 'creator'\n        - 'reader'\n        - 'updater'\n        - 'deleter'\n        - 'storage_reader'\n      resource_paths:\n        - '/programs/test'\n        - '/gen3/programs/test'\n\n    - id: 'programs.test-viewer'\n      description: ''\n      role_ids:\n        - 'reader'\n        - 'storage_reader'\n      resource_paths:\n        - '/programs/test'\n        - '/gen3/programs/test'\n\n    - id: 'abc-admin'\n      description: ''\n      role_ids:\n        - 'creator'\n        - 'reader'\n        - 'updater'\n        - 'deleter'\n        - 'storage_reader'\n      resource_paths:\n        - '/abc'\n\n    - id: 'gen3-admin'\n      description: ''\n      role_ids:\n        - 'creator'\n        - 'reader'\n        - 'updater'\n        - 'deleter'\n        - 'storage_reader'\n      resource_paths:\n        - '/gen3'\n\n    - id: 'gen3-hmb-researcher'\n      description: ''\n      role_ids:\n        - 'creator'\n        - 'reader'\n        - 'updater'\n        - 'deleter'\n        - 'storage_reader'\n      resource_paths:\n        - '/consents/NRES'\n        - '/consents/GRU'\n        - '/consents/GRU_CC'\n        - '/consents/HMB'\n        - '/gen3'\n\n    - id: 'abc.programs.test_program.projects.test_project1-viewer'\n      description: ''\n      role_ids:\n        - 'reader'\n        - 'storage_reader'\n      resource_paths:\n        - '/abc/programs/test_program/projects/test_project1'\n\n    - id: 'abc.programs.test_program.projects.test_project2-viewer'\n      description: ''\n      role_ids:\n        - 'reader'\n        - 'storage_reader'\n      resource_paths:\n        - '/abc/programs/test_program/projects/test_project2'\n\n    - id: 'abc.programs.test_program2.projects.test_project3-viewer'\n      description: ''\n      role_ids:\n        - 'reader'\n        - 'storage_reader'\n      resource_paths:\n        - '/abc/programs/test_program2/projects/test_project3'\n\n    # Open data policies\n    - id: 'authn_open_access'\n      resource_paths: ['/programs/open/projects/authnRequired']\n      description: ''\n      role_ids:\n        - 'reader'\n        - 'storage_reader'\n    - id: 'full_open_access'\n      resource_paths: ['/programs/open/projects/1000G']\n      description: ''\n      role_ids:\n        - 'reader'\n        - 'storage_reader'\n    - id: 'open_data_reader'\n      description: ''\n      role_ids:\n        - 'reader'\n        - 'storage_reader'\n      resource_paths: ['/open']\n    - id: 'open_data_admin'\n      description: ''\n      role_ids:\n        - 'creator'\n        - 'reader'\n        - 'updater'\n        - 'deleter'\n        - 'storage_writer'\n        - 'storage_reader'\n      resource_paths: ['/open']\n\n    # Consent Code Policies\n    - id: 'not-for-profit-researcher'\n      description: ''\n      role_ids:\n        - 'admin'\n      resource_paths:\n        - '/consents/NPU'\n\n    - id: 'publication-required-researcher'\n      description: ''\n      role_ids:\n        - 'admin'\n      resource_paths:\n        - '/consents/PUB'\n\n    - id: 'gru-researcher'\n      description: ''\n      role_ids:\n        - 'admin'\n      resource_paths:\n        - '/consents/NRES'\n        - '/consents/GRU'\n\n    - id: 'gru-cc-researcher'\n      description: ''\n      role_ids:\n        - 'admin'\n      resource_paths:\n        - '/consents/NRES'\n        - '/consents/GRU'\n        - '/consents/GRU_CC'\n\n    - id: 'hmb-researcher'\n      description: ''\n      role_ids:\n        - 'admin'\n      resource_paths:\n        - '/consents/NRES'\n        - '/consents/GRU'\n        - '/consents/GRU_CC'\n        - '/consents/HMB'\n\n    - id: 'poa-researcher'\n      description: ''\n      role_ids:\n        - 'admin'\n      resource_paths:\n        - '/consents/NRES'\n        - '/consents/GRU'\n        - '/consents/GRU_CC'\n        - '/consents/POA'\n\n    - id: 'ds-lung-researcher'\n      description: ''\n      role_ids:\n        - 'admin'\n      resource_paths:\n        - '/consents/NRES'\n        - '/consents/GRU'\n        - '/consents/GRU_CC'\n        - '/consents/HMB'\n        - '/consents/DS_LungDisease'\n\n    - id: 'ds-chronic-obstructive-pulmonary-disease-researcher'\n      description: ''\n      role_ids:\n        - 'admin'\n      resource_paths:\n        - '/consents/NRES'\n        - '/consents/GRU'\n        - '/consents/GRU_CC'\n        - '/consents/HMB'\n        - '/consents/DS_ChronicObstructivePulmonaryDisease'\n\n    - id: 'services.sheepdog-admin'\n      description: 'CRUD access to programs and projects'\n      role_ids:\n        - 'sheepdog_admin'\n      resource_paths:\n        - '/services/sheepdog/submission/program'\n        - '/services/sheepdog/submission/project'\n\n    # indexd\n    - id: 'indexd_admin'\n      description: 'full access to indexd API'\n      role_ids:\n        - 'indexd_admin'\n      resource_paths:\n        - '/programs'\n        - '/services/indexd/admin'\n    # # TODO resource path '/' is not valid right now in arborist, trying to decide\n    # #      how to handle all resources\n    # - id: 'indexd_admin'\n    #   description: ''\n    #   role_ids:\n    #     - 'indexd_record_creator'\n    #     - 'indexd_record_reader'\n    #     - 'indexd_record_updater'\n    #     - 'indexd_delete_record'\n    #     - 'indexd_storage_reader'\n    #     - 'indexd_storage_writer'\n    #   resource_paths: ['/']\n    # - id: 'indexd_record_reader'\n    #   description: ''\n    #   role_ids:\n    #     - 'indexd_record_reader'\n    #   resource_paths: ['/']\n    # - id: 'indexd_record_editor'\n    #   description: ''\n    #   role_ids:\n    #     - 'indexd_record_creator'\n    #     - 'indexd_record_reader'\n    #     - 'indexd_record_updater'\n    #     - 'indexd_delete_record'\n    #   resource_paths: ['/']\n    # - id: 'indexd_storage_reader'\n    #   description: ''\n    #   role_ids:\n    #     - 'indexd_storage_reader'\n    #   resource_paths: ['/']\n    # - id: 'indexd_storage_editor'\n    #   description: ''\n    #   role_ids:\n    #     - 'indexd_storage_reader'\n    #     - 'indexd_storage_writer'\n    #   resource_paths: ['/']\n\n    # argo\n    - id: argo\n      description: be able to use argo\n      resource_paths: [/argo]\n      role_ids: [argo_user]\n\n  resources:\n    # General Access\n    - name: 'data_file'\n      description: 'data files, stored in S3'\n    - name: 'dashboard'\n      description: 'commons /dashboard'\n    - name: 'mds_gateway'\n      description: 'commons /mds-admin'\n    - name: 'prometheus'\n      description: 'commons /prometheus and /grafana'\n    - name: 'ttyadmin'\n      description: 'commons /ttyadmin'\n    - name: 'workspace'\n    - name: \"sower\"\n    - name: 'mariner'\n      description: 'workflow execution service'\n    - name: argo\n\n    # OLD Data\n    - name: 'programs'\n      subresources:\n        - name: 'open'\n          subresources:\n            - name: 'projects'\n              subresources:\n                - name: '1000G'\n                - name: 'authnRequired'\n        - name: 'QA'\n          subresources:\n            - name: 'projects'\n              subresources:\n                - name: 'test'\n        - name: 'DEV'\n          subresources:\n            - name: 'projects'\n              subresources:\n                - name: 'test'\n        - name: 'jnkns'\n          subresources:\n            - name: 'projects'\n              subresources:\n                - name: 'jenkins'\n                - name: 'jenkins2'\n        - name: 'test'\n          subresources:\n            - name: 'projects'\n              subresources:\n                - name: 'test'\n\n    # NEW Data WITH PREFIX\n    - name: 'gen3'\n      subresources:\n        - name: 'programs'\n          subresources:\n            - name: 'QA'\n              subresources:\n                - name: 'projects'\n                  subresources:\n                    - name: 'test'\n            - name: 'DEV'\n              subresources:\n                - name: 'projects'\n                  subresources:\n                    - name: 'test'\n            - name: 'jnkns'\n              subresources:\n                - name: 'projects'\n                  subresources:\n                    - name: 'jenkins'\n                    - name: 'jenkins2'\n            - name: 'test'\n              subresources:\n                - name: 'projects'\n                  subresources:\n                    - name: 'test'\n\n    # consents obtained from DUO and NIH\n    # https://github.com/EBISPOT/DUO\n    # https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4721915/\n    - name: 'consents'\n      subresources:\n        - name: 'NRES'\n          description: 'no restriction'\n        - name: 'GRU'\n          description: 'general research use'\n        - name: 'GRU_CC'\n          description: 'general research use and clinical care'\n        - name: 'HMB'\n          description: 'health/medical/biomedical research'\n        - name: 'POA'\n          description: 'population origins or ancestry research'\n        - name: 'NMDS'\n          description: 'no general methods research'\n        - name: 'NPU'\n          description: 'not-for-profit use only'\n        - name: 'PUB'\n          description: 'publication required'\n        - name: 'DS_LungDisease'\n          description: 'disease-specific research for lung disease'\n        - name: 'DS_ChronicObstructivePulmonaryDisease'\n          description: 'disease-specific research for chronic obstructive pulmonary disease'\n\n    - name: 'abc'\n      subresources:\n        - name: 'programs'\n          subresources:\n            - name: 'foo'\n              subresources:\n                - name: 'projects'\n                  subresources:\n                    - name: 'bar'\n            - name: 'test_program'\n              subresources:\n                - name: 'projects'\n                  subresources:\n                    - name: 'test_project1'\n                    - name: 'test_project2'\n            - name: 'test_program2'\n              subresources:\n                - name: 'projects'\n                  subresources:\n                    - name: 'test_project3'\n\n\n    # \"Sheepdog admin\" resources\n    - name: 'services'\n      subresources:\n        - name: 'sheepdog'\n          subresources:\n            - name: 'submission'\n              subresources:\n                - name: 'program'\n                - name: 'project'\n        - name: 'indexd'\n          subresources:\n            - name: 'admin'\n            - name: 'bundles'\n        - name: audit\n          subresources:\n            - name: presigned_url\n            - name: login\n\n\n    - name: 'open'\n\n  # action/methods:\n  #     create, read, update, delete, read-storage, write-storage,\n  #     file_upload, access\n  roles:\n    # General Access\n    - id: 'file_uploader'\n      description: 'can upload data files'\n      permissions:\n        - id: 'file_upload'\n          action:\n            service: '*'\n            method: 'file_upload'\n    - id: 'workspace_user'\n      permissions:\n        - id: 'workspace_access'\n          action:\n            service: 'jupyterhub'\n            method: 'access'\n    - id: 'dashboard_user'\n      permissions:\n        - id: 'dashboard_access'\n          action:\n            service: 'dashboard'\n            method: 'access'\n    - id: 'mds_user'\n      permissions:\n        - id: 'mds_access'\n          action:\n            service: 'mds_gateway'\n            method: 'access'\n    - id: 'prometheus_user'\n      permissions:\n        - id: 'prometheus_access'\n          action:\n            service: 'prometheus'\n            method: 'access'\n    - id: 'ttyadmin_user'\n      permissions:\n        - id: 'ttyadmin_access'\n          action:\n            service: 'ttyadmin'\n            method: 'access'\n    - id: 'sower_user'\n      permissions:\n        - id: 'sower_access'\n          action:\n            service: 'job'\n            method: 'access'\n    - id: 'mariner_admin'\n      permissions:\n        - id: 'mariner_access'\n          action:\n            service: 'mariner'\n            method: 'access'\n    - id: audit_reader\n      permissions:\n        - id: audit_reader_action\n          action:\n            service: audit\n            method: read\n\n    # All services\n    - id: 'admin'\n      description: ''\n      permissions:\n        - id: 'admin'\n          action:\n            service: '*'\n            method: '*'\n    - id: 'creator'\n      description: ''\n      permissions:\n        - id: 'creator'\n          action:\n            service: '*'\n            method: 'create'\n    - id: 'reader'\n      description: ''\n      permissions:\n        - id: 'reader'\n          action:\n            service: '*'\n            method: 'read'\n    - id: 'updater'\n      description: ''\n      permissions:\n        - id: 'updater'\n          action:\n            service: '*'\n            method: 'update'\n    - id: 'deleter'\n      description: ''\n      permissions:\n        - id: 'deleter'\n          action:\n            service: '*'\n            method: 'delete'\n    - id: 'storage_writer'\n      description: ''\n      permissions:\n        - id: 'storage_writer'\n          action:\n            service: '*'\n            method: 'write-storage'\n    - id: 'storage_reader'\n      description: ''\n      permissions:\n        - id: 'storage_reader'\n          action:\n            service: '*'\n            method: 'read-storage'\n\n\n    # Sheepdog admin role\n    - id: 'sheepdog_admin'\n      description: 'sheepdog admin role for program project crud'\n      permissions:\n        - id: 'sheepdog_admin_action'\n          action:\n            service: 'sheepdog'\n            method: '*'\n\n\n    # indexd\n    - id: 'indexd_admin'\n      # this only works if indexd.arborist is enabled in manifest!\n      description: 'full access to indexd API'\n      permissions:\n        - id: 'indexd_admin'\n          action:\n            service: 'indexd'\n            method: '*'\n    - id: 'indexd_record_creator'\n      description: ''\n      permissions:\n        - id: 'indexd_record_creator'\n          action:\n            service: 'indexd'\n            method: 'create'\n    - id: 'indexd_record_reader'\n      description: ''\n      permissions:\n        - id: 'indexd_record_reader'\n          action:\n            service: 'indexd'\n            method: 'read'\n    - id: 'indexd_record_updater'\n      description: ''\n      permissions:\n        - id: 'indexd_record_updater'\n          action:\n            service: 'indexd'\n            method: 'update'\n    - id: 'indexd_delete_record'\n      description: ''\n      permissions:\n        - id: 'indexd_delete_record'\n          action:\n            service: 'indexd'\n            method: 'delete'\n    - id: 'indexd_storage_reader'\n      description: ''\n      permissions:\n        - id: 'indexd_storage_reader'\n          action:\n            service: 'indexd'\n            method: 'read-storage'\n    - id: 'indexd_storage_writer'\n      description: ''\n      permissions:\n        - id: 'indexd_storage_writer'\n          action:\n            service: 'indexd'\n            method: 'write-storage'\n\n    # arborist\n    - id: 'arborist_creator'\n      description: ''\n      permissions:\n        - id: 'arborist_creator'\n          action:\n            service: 'arborist'\n            method: 'create'\n    - id: 'arborist_reader'\n      description: ''\n      permissions:\n        - id: 'arborist_reader'\n          action:\n            service: 'arborist'\n            method: 'read'\n    - id: 'arborist_updater'\n      description: ''\n      permissions:\n        - id: 'arborist_updater'\n          action:\n            service: 'arborist'\n            method: 'update'\n    - id: 'arborist_deleter'\n      description: ''\n      permissions:\n        - id: 'arborist_deleter'\n          action:\n            service: 'arborist'\n            method: 'delete'\n\n    # requestor\n    - id: requestor_admin\n      permissions:\n      - id: requestor_admin_action\n        action:\n          service: requestor\n          method: '*'\n    - id: requestor_reader\n      permissions:\n      - id: requestor_reader_action\n        action:\n          service: requestor\n          method: read\n    - id: requestor_creator\n      permissions:\n      - id: requestor_creator_action\n        action:\n          service: requestor\n          method: create\n    - id: requestor_updater\n      permissions:\n      - id: requestor_updater_action\n        action:\n          service: requestor\n          method: update\n    - id: requestor_deleter\n      permissions:\n      - id: requestor_deleter_action\n        action:\n          service: requestor\n          method: delete\n    # argo\n    - id: argo_user\n      permissions:\n        - id: argo_access\n          action:\n            service: argo\n            method: access\n\nclients:\n  basic-test-client:\n    policies:\n    - abc-admin\n    - gen3-admin\n  basic-test-abc-client:\n    policies:\n    - abc-admin\n  wts:\n    policies:\n    - all_programs_reader\n    - workspace\n\nusers:\n  ### BEGIN INTERNS SECTION ###\n  ### END INTERNS SECTION ###\n  qureshi@uchicago.edu:\n    admin: true\n    policies:\n    - data_upload\n    - workspace\n    - dashboard\n    - mds_admin\n    - prometheus\n    - sower\n    - services.sheepdog-admin\n    - programs.QA-admin\n    - programs.test-admin\n    - programs.DEV-admin\n    - programs.jnkns-admin\n    - indexd_admin\n    - ttyadmin\n    projects:\n    - auth_id: QA\n      privilege: [create, read, update, delete, upload, read-storage]\n    - auth_id: test\n      privilege: [create, read, update, delete, upload, read-storage]\n    - auth_id: DEV\n      privilege: [create, read, update, delete, upload, read-storage]\n    - auth_id: jenkins\n      privilege: [create, read, update, delete, upload, read-storage]\n    - auth_id: jenkins2\n      privilege: [create, read, update, delete, upload, read-storage]\n    - auth_id: jnkns\n      privilege: [create, read, update, delete, upload, read-storage]\n"` | USER YAML. Passed in as a multiline string. |
| affinity | map | `{"podAntiAffinity":{"preferredDuringSchedulingIgnoredDuringExecution":[{"podAffinityTerm":{"labelSelector":{"matchExpressions":[{"key":"app","operator":"In","values":["fence"]}]},"topologyKey":"kubernetes.io/hostname"},"weight":100}]}}` | Affinity to use for the deployment. |
| affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution | map | `[{"podAffinityTerm":{"labelSelector":{"matchExpressions":[{"key":"app","operator":"In","values":["fence"]}]},"topologyKey":"kubernetes.io/hostname"},"weight":100}]` | Option for scheduling to be required or preferred. |
| affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[0] | int | `{"podAffinityTerm":{"labelSelector":{"matchExpressions":[{"key":"app","operator":"In","values":["fence"]}]},"topologyKey":"kubernetes.io/hostname"},"weight":100}` | Weight value for preferred scheduling. |
| affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[0].podAffinityTerm.labelSelector.matchExpressions[0] | list | `{"key":"app","operator":"In","values":["fence"]}` | Label key for match expression. |
| affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[0].podAffinityTerm.labelSelector.matchExpressions[0].operator | string | `"In"` | Operation type for the match expression. |
| affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[0].podAffinityTerm.labelSelector.matchExpressions[0].values | list | `["fence"]` | Value for the match expression key. |
| affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[0].podAffinityTerm.topologyKey | string | `"kubernetes.io/hostname"` | Value for topology key label. |
| autoscaling | map | `{"enabled":false,"maxReplicas":4,"minReplicas":1,"targetCPUUtilizationPercentage":80,"targetMemoryUtilizationPercentage":80}` | Configuration for autoscaling the number of replicas |
| autoscaling.enabled | bool | `false` | Whether autoscaling is enabled |
| autoscaling.maxReplicas | int | `4` | The maximum number of replicas to scale up to |
| autoscaling.minReplicas | int | `1` | The minimum number of replicas to scale down to |
| autoscaling.targetCPUUtilizationPercentage | int | `80` | Target CPU utilization percentage |
| autoscaling.targetMemoryUtilizationPercentage | int | `80` | Target Memory utilization percentage |
| commonLabels | map | `nil` | Will completely override the commonLabels defined in the common chart's _label_setup.tpl |
| criticalService | string | `"true"` | Valid options are "true" or "false". If invalid option is set- the value will default to "false". |
| datadogLogsInjection | bool | `true` | If enabled, the Datadog Agent will automatically inject Datadog-specific metadata into your application logs. |
| datadogProfilingEnabled | bool | `true` | If enabled, the Datadog Agent will collect profiling data for your application using the Continuous Profiler. This data can be used to identify performance bottlenecks and optimize your application. |
| datadogTraceSampleRate | int | `1` | A value between 0 and 1, that represents the percentage of requests that will be traced. For example, a value of 0.5 means that 50% of requests will be traced. |
| env | list | `[{"name":"GEN3_UWSGI_TIMEOUT","valueFrom":{"configMapKeyRef":{"key":"uwsgi-timeout","name":"manifest-global","optional":true}}},{"name":"DD_AGENT_HOST","valueFrom":{"fieldRef":{"fieldPath":"status.hostIP"}}},{"name":"AWS_STS_REGIONAL_ENDPOINTS","value":"regional"},{"name":"PYTHONPATH","value":"/var/www/fence"},{"name":"GEN3_DEBUG","value":"False"},{"name":"FENCE_PUBLIC_CONFIG","valueFrom":{"configMapKeyRef":{"key":"fence-config-public.yaml","name":"manifest-fence","optional":true}}},{"name":"PGHOST","valueFrom":{"secretKeyRef":{"key":"host","name":"fence-dbcreds","optional":false}}},{"name":"PGUSER","valueFrom":{"secretKeyRef":{"key":"username","name":"fence-dbcreds","optional":false}}},{"name":"PGPASSWORD","valueFrom":{"secretKeyRef":{"key":"password","name":"fence-dbcreds","optional":false}}},{"name":"PGDB","valueFrom":{"secretKeyRef":{"key":"database","name":"fence-dbcreds","optional":false}}},{"name":"DBREADY","valueFrom":{"secretKeyRef":{"key":"dbcreated","name":"fence-dbcreds","optional":false}}},{"name":"DB","value":"postgresql://$(PGUSER):$(PGPASSWORD)@$(PGHOST):5432/$(PGDB)"}]` | Environment variables to pass to the container |
| fullnameOverride | string | `""` | Override the full name of the deployment. |
| global | map | `{"ddEnabled":false,"dev":true,"dictionaryUrl":"https://s3.amazonaws.com/dictionary-artifacts/datadictionary/develop/schema.json","dispatcherJobNum":10,"environment":"default","hostname":"localhost","kubeBucket":"kube-gen3","logsBucket":"logs-gen3","netPolicy":true,"portalApp":"gitops","postgres":{"dbCreate":true,"master":{"host":null,"password":null,"port":"5432","username":"postgres"}},"publicDataSets":true,"revproxyArn":"arn:aws:acm:us-east-1:123456:certificate","syncFromDbgap":false,"tierAccessLevel":"libre","userYamlS3Path":"s3://cdis-gen3-users/test/user.yaml"}` | Global configuration options. |
| global.ddEnabled | bool | `false` | Whether Datadog is enabled. |
| global.dev | bool | `true` | Whether the deployment is for development purposes. |
| global.dictionaryUrl | string | `"https://s3.amazonaws.com/dictionary-artifacts/datadictionary/develop/schema.json"` | URL of the data dictionary. |
| global.dispatcherJobNum | int | `10` | Number of dispatcher jobs. |
| global.environment | string | `"default"` | Environment name. This should be the same as vpcname if you're doing an AWS deployment. Currently this is being used to share ALB's if you have multiple namespaces. Might be used other places too. |
| global.hostname | string | `"localhost"` | Hostname for the deployment. |
| global.kubeBucket | string | `"kube-gen3"` | S3 bucket name for Kubernetes manifest files. |
| global.logsBucket | string | `"logs-gen3"` | S3 bucket name for log files. |
| global.netPolicy | bool | `true` | Whether network policies are enabled. |
| global.portalApp | string | `"gitops"` | Portal application name. |
| global.postgres | map | `{"dbCreate":true,"master":{"host":null,"password":null,"port":"5432","username":"postgres"}}` | Postgres database configuration. |
| global.postgres.dbCreate | bool | `true` | Whether the database should be created. |
| global.postgres.master | map | `{"host":null,"password":null,"port":"5432","username":"postgres"}` | Master credentials to postgres. This is going to be the default postgres server being used for each service, unless each service specifies their own postgres |
| global.postgres.master.host | string | `nil` | hostname of postgres server |
| global.postgres.master.password | string | `nil` | password for superuser in postgres. This is used to create or restore databases |
| global.postgres.master.port | string | `"5432"` | Port for Postgres. |
| global.postgres.master.username | string | `"postgres"` | username of superuser in postgres. This is used to create or restore databases |
| global.publicDataSets | bool | `true` | Whether public datasets are enabled. |
| global.revproxyArn | string | `"arn:aws:acm:us-east-1:123456:certificate"` | ARN of the reverse proxy certificate. |
| global.syncFromDbgap | bool | `false` | Whether to sync data from dbGaP. |
| global.tierAccessLevel | string | `"libre"` | Access level for tiers. acceptable values for `tier_access_level` are: `libre`, `regular` and `private`. If omitted, by default common will be treated as `private` |
| global.userYamlS3Path | string | `"s3://cdis-gen3-users/test/user.yaml"` | Path to the user.yaml file in S3. |
| image.pullPolicy | string | `"Always"` | When to pull the image. This value should be "Always" to ensure the latest image is used. |
| image.repository | string | `"quay.io/cdis/fence"` | The Docker image repository for the fence service |
| image.tag | string | `"master"` | Overrides the image tag whose default is the chart appVersion. |
| imagePullSecrets | list | `[]` | Docker image pull secrets. |
| initEnv | list | `[{"name":"PGHOST","valueFrom":{"secretKeyRef":{"key":"host","name":"fence-dbcreds","optional":false}}},{"name":"PGUSER","valueFrom":{"secretKeyRef":{"key":"username","name":"fence-dbcreds","optional":false}}},{"name":"PGPASSWORD","valueFrom":{"secretKeyRef":{"key":"password","name":"fence-dbcreds","optional":false}}},{"name":"PGDB","valueFrom":{"secretKeyRef":{"key":"database","name":"fence-dbcreds","optional":false}}},{"name":"DBREADY","valueFrom":{"secretKeyRef":{"key":"dbcreated","name":"fence-dbcreds","optional":false}}},{"name":"DB","value":"postgresql://$(PGUSER):$(PGPASSWORD)@$(PGHOST):5432/$(PGDB)"},{"name":"PYTHONPATH","value":"/var/www/fence"},{"name":"FENCE_PUBLIC_CONFIG","valueFrom":{"configMapKeyRef":{"key":"fence-config-public.yaml","name":"manifest-fence","optional":true}}}]` | Volumes to attach to the init container. |
| initVolumeMounts | list | `[{"mountPath":"/var/www/fence/fence-config.yaml","name":"config-volume","readOnly":true,"subPath":"fence-config.yaml"},{"mountPath":"/var/www/fence/yaml_merge.py","name":"yaml-merge","readOnly":true,"subPath":"yaml_merge.py"},{"mountPath":"/var/www/fence/fence_google_app_creds_secret.json","name":"fence-google-app-creds-secret-volume","readOnly":true,"subPath":"fence_google_app_creds_secret.json"},{"mountPath":"/var/www/fence/fence_google_storage_creds_secret.json","name":"fence-google-storage-creds-secret-volume","readOnly":true,"subPath":"fence_google_storage_creds_secret.json"}]` | Volumes to mount to the init container. |
| labels | map | `{"authprovider":"yes","netnolimit":"yes","public":"yes","userhelper":"yes"}` | Labels to add to the pod. |
| labels.authprovider | string | `"yes"` | Grants egress from all pods to pods labeled with authrpovider=yes. For network policy selectors. |
| labels.netnolimit | string | `"yes"` | Grants egress from pods labeled with netnolimit=yes to any IP address. Use explicit proxy and AWS APIs |
| labels.public | string | `"yes"` | Grants ingress from the revproxy service for pods labeled with public=yes |
| labels.userhelper | string | `"yes"` | Grants ingress from pods in usercode namespaces for gen3 pods labeled with userhelper=yes |
| logo | string | `nil` |  |
| nameOverride | string | `""` | Override the name of the chart. |
| nodeSelector | map | `{}` | Node Selector for the pods |
| partOf | string | `"Authentication"` | Label to help organize pods and their use. Any value is valid, but use "_" or "-" to divide words. |
| podAnnotations | map | `{}` | Annotations to add to the pod |
| podSecurityContext | map | `{"fsGroup":101}` | Security context for the pod |
| postgres | map | `{"database":null,"dbCreate":null,"dbRestore":false,"host":null,"password":null,"port":"5432","separate":false,"username":null}` | Postgres database configuration. If db does not exist in postgres cluster and dbCreate is set ot true then these databases will be created for you |
| postgres.database | string | `nil` | Database name for postgres. This is a service override, defaults to <serviceName>-<releaseName> |
| postgres.dbCreate | bool | `nil` | Whether the database should be created. Default to global.postgres.dbCreate |
| postgres.host | string | `nil` | Hostname for postgres server. This is a service override, defaults to global.postgres.host |
| postgres.password | string | `nil` | Password for Postgres. Will be autogenerated if left empty. |
| postgres.port | string | `"5432"` | Port for Postgres. |
| postgres.separate | string | `false` | Will create a Database for the individual service to help with developing it. |
| postgres.username | string | `nil` | Username for postgres. This is a service override, defaults to <serviceName>-<releaseName> |
| postgresql | map | `{"primary":{"persistence":{"enabled":false}}}` | Postgresql subchart settings if deployed separately option is set to "true". Disable persistence by default so we can spin up and down ephemeral environments |
| postgresql.primary.persistence.enabled | bool | `false` | Option to persist the dbs data. |
| privacy_policy | string | `nil` |  |
| release | string | `"production"` | Valid options are "production" or "dev". If invalid option is set- the value will default to "dev". |
| replicaCount | int | `1` | Number of desired replicas |
| resources | map | `{"limits":{"cpu":1,"memory":"2Gi"},"requests":{"cpu":0.3,"memory":"128Mi"}}` | Resource requests and limits for the containers in the pod |
| resources.limits | map | `{"cpu":1,"memory":"2Gi"}` | The maximum amount of resources that the container is allowed to use |
| resources.limits.cpu | string | `1` | The maximum amount of CPU the container can use |
| resources.limits.memory | string | `"2Gi"` | The maximum amount of memory the container can use |
| resources.requests | map | `{"cpu":0.3,"memory":"128Mi"}` | The amount of resources that the container requests |
| resources.requests.cpu | string | `0.3` | The amount of CPU requested |
| resources.requests.memory | string | `"128Mi"` | The amount of memory requested |
| securityContext | map | `{}` | Security context for the containers in the pod |
| selectorLabels | map | `nil` | Will completely override the selectorLabels defined in the common chart's _label_setup.tpl |
| service | map | `{"port":80,"type":"ClusterIP"}` | Kubernetes service information. |
| service.port | int | `80` | The port number that the service exposes. |
| service.type | string | `"ClusterIP"` | Type of service. Valid values are "ClusterIP", "NodePort", "LoadBalancer", "ExternalName". |
| serviceAccount | map | `{"annotations":{"eks.amazonaws.com/role-arn":null},"create":true,"name":"fence-sa"}` | Service account to use or create. |
| serviceAccount.annotations | map | `{"eks.amazonaws.com/role-arn":null}` | Annotations to add to the service account. |
| serviceAccount.annotations."eks.amazonaws.com/role-arn" | string | `nil` | The Amazon Resource Name (ARN) of the role to associate with the service account |
| serviceAccount.create | bool | `true` | Specifies whether a service account should be created. |
| serviceAccount.name | string | `"fence-sa"` | The name of the service account |
| tolerations | list | `[]` | Tolerations for the pods |
| volumeMounts | list | `[{"mountPath":"/var/www/fence/local_settings.py","name":"old-config-volume","readOnly":true,"subPath":"local_settings.py"},{"mountPath":"/var/www/fence/fence_credentials.json","name":"json-secret-volume","readOnly":true,"subPath":"fence_credentials.json"},{"mountPath":"/var/www/fence/creds.json","name":"creds-volume","readOnly":true,"subPath":"creds.json"},{"mountPath":"/var/www/fence/config_helper.py","name":"config-helper","readOnly":true,"subPath":"config_helper.py"},{"mountPath":"/fence/fence/static/img/logo.svg","name":"logo-volume","readOnly":true,"subPath":"logo.svg"},{"mountPath":"/fence/fence/static/privacy_policy.md","name":"privacy-policy","readOnly":true,"subPath":"privacy_policy.md"},{"mountPath":"/var/www/fence/fence-config.yaml","name":"config-volume","readOnly":true,"subPath":"fence-config.yaml"},{"mountPath":"/var/www/fence/yaml_merge.py","name":"yaml-merge","readOnly":true,"subPath":"yaml_merge.py"},{"mountPath":"/var/www/fence/fence_google_app_creds_secret.json","name":"fence-google-app-creds-secret-volume","readOnly":true,"subPath":"fence_google_app_creds_secret.json"},{"mountPath":"/var/www/fence/fence_google_storage_creds_secret.json","name":"fence-google-storage-creds-secret-volume","readOnly":true,"subPath":"fence_google_storage_creds_secret.json"},{"mountPath":"/fence/keys/key/jwt_private_key.pem","name":"fence-jwt-keys","readOnly":true,"subPath":"jwt_private_key.pem"}]` | Volumes to mount to the container. |
| volumes | list | `[{"name":"old-config-volume","secret":{"secretName":"fence-secret"}},{"name":"json-secret-volume","secret":{"optional":true,"secretName":"fence-json-secret"}},{"name":"creds-volume","secret":{"secretName":"fence-creds"}},{"configMap":{"name":"config-helper","optional":true},"name":"config-helper"},{"configMap":{"name":"logo-config"},"name":"logo-volume"},{"name":"config-volume","secret":{"secretName":"fence-config"}},{"name":"fence-google-app-creds-secret-volume","secret":{"secretName":"fence-google-app-creds-secret"}},{"name":"fence-google-storage-creds-secret-volume","secret":{"secretName":"fence-google-storage-creds-secret"}},{"name":"fence-jwt-keys","secret":{"secretName":"fence-jwt-keys"}},{"configMap":{"name":"privacy-policy"},"name":"privacy-policy"},{"configMap":{"name":"fence-yaml-merge","optional":true},"name":"yaml-merge"}]` | Volumes to attach to the container. |

----------------------------------------------
Autogenerated from chart metadata using [helm-docs v1.11.0](https://github.com/norwoodj/helm-docs/releases/v1.11.0)
